# 业务稳定性监控系统 - 接口规范文档

## 文档信息
- 版本：v2.1.0
- 创建日期：2025-09-28
- 更新日期：2025-09-28
- 文档状态：最新
- 接口协议：RESTful API / HTTP/HTTPS

## 📋 目录
1. [接口概述](#接口概述)
2. [通用规范](#通用规范)
3. [数据模型](#数据模型)
4. [组织架构接口](#组织架构接口)
5. [业务系统接口](#业务系统接口)
6. [资产管理接口](#资产管理接口)
7. [告警监控接口](#告警监控接口)
8. [指标统计接口](#指标统计接口)
9. [WebSocket实时接口](#websocket实时接口)
10. [错误处理](#错误处理)

## 接口概述

### 当前状态
- **Mock模式**：当前系统使用前端Mock数据，所有接口均为模拟实现
- **真实接口**：本文档描述了系统对接真实后端时的接口规范
- **版本管理**：采用URL版本控制，如`/api/v1/`

### 基础信息
- **Base URL**: `https://api.example.com/api/v1`
- **协议**: HTTPS
- **认证方式**: Bearer Token / API Key
- **数据格式**: JSON
- **字符编码**: UTF-8

## 通用规范

### HTTP状态码
```
200 OK              - 请求成功
201 Created         - 资源创建成功
204 No Content      - 删除成功
400 Bad Request     - 请求参数错误
401 Unauthorized    - 未授权访问
403 Forbidden       - 权限不足
404 Not Found       - 资源不存在
422 Unprocessable   - 数据验证失败
500 Internal Error  - 服务器内部错误
502 Bad Gateway     - 网关错误
503 Service Unavailable - 服务不可用
```

### 统一响应格式
```typescript
interface ApiResponse<T> {
  code: number          // 业务状态码
  message: string       // 响应消息
  data: T              // 响应数据
  timestamp: string    // 响应时间戳
  requestId?: string   // 请求ID（用于追踪）
}

// 成功响应示例
{
  "code": 200,
  "message": "success",
  "data": { /* 实际数据 */ },
  "timestamp": "2025-09-28T10:00:00Z",
  "requestId": "req_12345"
}

// 错误响应示例
{
  "code": 400,
  "message": "参数验证失败",
  "data": null,
  "timestamp": "2025-09-28T10:00:00Z",
  "requestId": "req_12345",
  "errors": [
    {
      "field": "organizationId",
      "message": "组织ID不能为空"
    }
  ]
}
```

### 分页规范
```typescript
interface PaginationRequest {
  page: number        // 页码，从1开始
  pageSize: number    // 每页大小，默认20，最大100
  sortBy?: string     // 排序字段
  sortOrder?: 'asc' | 'desc'  // 排序方向
}

interface PaginationResponse<T> {
  list: T[]           // 数据列表
  pagination: {
    page: number      // 当前页码
    pageSize: number  // 每页大小
    total: number     // 总记录数
    totalPages: number // 总页数
    hasNext: boolean  // 是否有下一页
    hasPrev: boolean  // 是否有上一页
  }
}
```

### 请求头规范
```
Content-Type: application/json
Authorization: Bearer {token}
X-API-Version: v1
X-Request-ID: {unique_id}
Accept: application/json
User-Agent: BizStable-Frontend/2.1.0
```

## 数据模型

### 组织节点模型
```typescript
interface OrganizationNode {
  id: string                    // 节点ID
  name: string                  // 节点名称
  type: 'root' | 'department' | 'system' | 'asset'  // 节点类型
  parentId?: string             // 父节点ID
  level: number                 // 层级深度
  systemCount: number           // 系统数量
  assetCount: number            // 资产数量
  healthStatus: HealthStatus    // 健康状态
  children?: OrganizationNode[] // 子节点列表
  isExpanded?: boolean          // 是否展开
  metadata?: Record<string, any> // 扩展元数据
  createdAt: string            // 创建时间
  updatedAt: string            // 更新时间
}
```

### 业务系统模型
```typescript
interface BusinessSystem {
  id: string                   // 系统ID
  name: string                 // 系统名称
  displayName?: string         // 显示名称
  description?: string         // 系统描述
  department: string           // 所属部门
  departmentId: string         // 部门ID
  importance: ImportanceLevel  // 重要性等级
  healthStatus: HealthStatus   // 健康状态
  assetCount: number          // 资产数量
  vulnerabilityCount: number   // 漏洞数量
  alertCount: number          // 告警数量
  errorRate: number           // 错误率(%)
  responseTime: number        // 响应时间(ms)
  availability: number        // 可用性(%)
  owner?: string              // 责任人
  contact?: string            // 联系方式
  lastCheck?: string          // 最后检查时间
  createdAt: string           // 创建时间
  updatedAt: string           // 更新时间
}
```

### 资产模型
```typescript
interface Asset {
  id: string                  // 资产ID
  name: string                // 资产名称
  type: string                // 资产类型
  healthStatus: HealthStatus  // 健康状态
  importance: ImportanceLevel // 重要性等级
  systemId: string           // 所属系统ID
  systemName: string         // 系统名称
  departmentId: string       // 部门ID
  department: string         // 部门名称
  ipAddress?: string         // IP地址
  hostname?: string          // 主机名
  location?: string          // 物理位置
  description?: string       // 资产描述
  errorRate: number          // 错误率(%)
  responseTime: number       // 响应时间(ms)
  availability: number       // 可用性(%)
  alertCount: number         // 告警数量
  vulnerabilityCount: number // 漏洞数量
  lastCheck?: string         // 最后检查时间
  createdAt: string          // 创建时间
  updatedAt: string          // 更新时间
}
```

### 告警模型
```typescript
interface Alert {
  id: string                 // 告警ID
  type: 'RUNTIME' | 'VULNERABILITY' | 'SECURITY'  // 告警类型
  level: AlertLevel          // 告警级别
  title: string              // 告警标题
  description: string        // 告警描述
  systemId: string          // 关联系统ID
  systemName: string        // 系统名称
  assetId?: string          // 关联资产ID
  assetName?: string        // 资产名称
  department: string        // 所属部门
  status: 'OPEN' | 'ACKNOWLEDGED' | 'RESOLVED' | 'CLOSED'  // 告警状态
  severity: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW'  // 严重程度
  timestamp: string         // 告警时间
  acknowledgedAt?: string   // 确认时间
  resolvedAt?: string       // 解决时间
  assignee?: string         // 处理人
  tags?: string[]           // 标签
  metadata?: Record<string, any>  // 扩展信息
}
```

## 组织架构接口

### 获取组织架构树
```http
GET /api/v1/organizations/tree
```

**查询参数**:
```typescript
interface GetOrganizationTreeParams {
  includeAssets?: boolean    // 是否包含资产节点，默认false
  maxDepth?: number         // 最大深度，默认不限制
  healthStatusFilter?: HealthStatus[]  // 健康状态过滤
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "org_root",
      "name": "XX市大数据中心",
      "type": "root",
      "level": 0,
      "systemCount": 25,
      "assetCount": 156,
      "healthStatus": "WARNING",
      "children": [
        {
          "id": "dept_001",
          "name": "市公安局",
          "type": "department",
          "parentId": "org_root",
          "level": 1,
          "systemCount": 5,
          "assetCount": 32,
          "healthStatus": "HEALTHY",
          "children": []
        }
      ],
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-09-28T10:00:00Z"
    }
  ],
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 获取单个节点详情
```http
GET /api/v1/organizations/{id}
```

**路径参数**:
- `id`: 组织节点ID

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "dept_001",
    "name": "市公安局",
    "type": "department",
    "parentId": "org_root",
    "level": 1,
    "systemCount": 5,
    "assetCount": 32,
    "healthStatus": "HEALTHY",
    "metadata": {
      "contact": "张三",
      "phone": "138****1234",
      "address": "市政府大楼3楼"
    },
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-09-28T10:00:00Z"
  },
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 获取子节点列表
```http
GET /api/v1/organizations/{id}/children
```

**查询参数**:
```typescript
interface GetChildrenParams {
  type?: 'department' | 'system' | 'asset'  // 子节点类型过滤
  healthStatus?: HealthStatus[]              // 健康状态过滤
  page?: number                             // 页码
  pageSize?: number                         // 每页大小
}
```

## 业务系统接口

### 获取业务系统列表
```http
GET /api/v1/systems
```

**查询参数**:
```typescript
interface GetSystemsParams {
  departmentId?: string      // 部门ID过滤
  healthStatus?: HealthStatus[]  // 健康状态过滤
  importance?: ImportanceLevel[] // 重要性过滤
  search?: string           // 关键词搜索
  sortBy?: string          // 排序字段
  sortOrder?: 'asc' | 'desc'  // 排序方向
  page?: number            // 页码
  pageSize?: number        // 每页大小
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "sys_001",
        "name": "公安执法系统",
        "displayName": "公安执法管理平台",
        "description": "公安部门日常执法管理系统",
        "department": "市公安局",
        "departmentId": "dept_001",
        "importance": "HIGH",
        "healthStatus": "HEALTHY",
        "assetCount": 15,
        "vulnerabilityCount": 2,
        "alertCount": 0,
        "errorRate": 0.5,
        "responseTime": 120,
        "availability": 99.8,
        "owner": "李四",
        "contact": "li.si@gov.cn",
        "lastCheck": "2025-09-28T09:30:00Z",
        "createdAt": "2025-01-01T00:00:00Z",
        "updatedAt": "2025-09-28T09:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 25,
      "totalPages": 2,
      "hasNext": true,
      "hasPrev": false
    }
  },
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 获取系统详情
```http
GET /api/v1/systems/{id}
```

### 获取系统资产列表
```http
GET /api/v1/systems/{id}/assets
```

### 获取系统告警列表
```http
GET /api/v1/systems/{id}/alerts
```

## 资产管理接口

### 获取资产列表
```http
GET /api/v1/assets
```

**查询参数**:
```typescript
interface GetAssetsParams {
  systemId?: string         // 系统ID过滤
  departmentId?: string     // 部门ID过滤
  type?: string[]          // 资产类型过滤
  healthStatus?: HealthStatus[]  // 健康状态过滤
  importance?: ImportanceLevel[] // 重要性过滤
  hasAlerts?: boolean      // 是否有告警
  hasVulnerabilities?: boolean  // 是否有漏洞
  search?: string         // 关键词搜索
  page?: number           // 页码
  pageSize?: number       // 每页大小
}
```

### 获取资产详情
```http
GET /api/v1/assets/{id}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "asset_001",
    "name": "服务器-01",
    "type": "服务器",
    "healthStatus": "HEALTHY",
    "importance": "HIGH",
    "systemId": "sys_001",
    "systemName": "公安执法系统",
    "departmentId": "dept_001",
    "department": "市公安局",
    "ipAddress": "192.168.1.100",
    "hostname": "app-server-01",
    "location": "机房A-01",
    "description": "核心应用服务器",
    "errorRate": 0.2,
    "responseTime": 85,
    "availability": 99.9,
    "alertCount": 0,
    "vulnerabilityCount": 1,
    "lastCheck": "2025-09-28T09:45:00Z",
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-09-28T09:45:00Z"
  },
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 获取资产指标历史
```http
GET /api/v1/assets/{id}/metrics
```

**查询参数**:
```typescript
interface GetAssetMetricsParams {
  startTime: string        // 开始时间
  endTime: string          // 结束时间
  interval?: string        // 采样间隔 (5m, 1h, 1d)
  metrics?: string[]       // 指标名称列表
}
```

## 告警监控接口

### 获取告警列表
```http
GET /api/v1/alerts
```

**查询参数**:
```typescript
interface GetAlertsParams {
  type?: ('RUNTIME' | 'VULNERABILITY' | 'SECURITY')[]  // 告警类型
  level?: AlertLevel[]      // 告警级别
  status?: ('OPEN' | 'ACKNOWLEDGED' | 'RESOLVED' | 'CLOSED')[]  // 告警状态
  severity?: ('CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW')[]  // 严重程度
  systemId?: string        // 系统ID过滤
  departmentId?: string    // 部门ID过滤
  assetId?: string        // 资产ID过滤
  assignee?: string       // 处理人过滤
  startTime?: string      // 开始时间
  endTime?: string        // 结束时间
  search?: string         // 关键词搜索
  page?: number           // 页码
  pageSize?: number       // 每页大小
}
```

### 获取告警详情
```http
GET /api/v1/alerts/{id}
```

### 确认告警
```http
POST /api/v1/alerts/{id}/acknowledge
```

**请求体**:
```json
{
  "comment": "已确认，正在处理中"
}
```

### 解决告警
```http
POST /api/v1/alerts/{id}/resolve
```

**请求体**:
```json
{
  "solution": "重启服务已解决问题",
  "comment": "问题已修复"
}
```

### 获取告警统计
```http
GET /api/v1/alerts/statistics
```

**查询参数**:
```typescript
interface GetAlertStatisticsParams {
  groupBy: 'type' | 'level' | 'status' | 'department' | 'system'  // 分组维度
  startTime?: string       // 开始时间
  endTime?: string         // 结束时间
  departmentId?: string    // 部门ID过滤
  systemId?: string        // 系统ID过滤
}
```

## 指标统计接口

### 获取KPI指标
```http
GET /api/v1/metrics/kpi
```

**查询参数**:
```typescript
interface GetKPIMetricsParams {
  scope?: 'global' | 'department' | 'system'  // 统计范围
  targetId?: string        // 目标ID（部门ID或系统ID）
  timeRange?: string       // 时间范围 (1h, 24h, 7d, 30d)
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalSystems": {
      "count": 25,
      "trend": "+2",  // 相比上期变化
      "trendType": "up"
    },
    "abnormalSystems": {
      "count": 3,
      "warningCount": 2,
      "criticalCount": 1,
      "rate": 12.0,
      "trend": "-1",
      "trendType": "down"
    },
    "urgentAlerts": {
      "total": 8,
      "p0Count": 1,
      "p1Count": 3,
      "latestTime": "2025-09-28T09:30:00Z",
      "trend": "+2",
      "trendType": "up"
    },
    "criticalVulnerabilities": {
      "count": 15,
      "affectedSystems": 8,
      "longestUnfixed": 7,  // 天数
      "trend": "-3",
      "trendType": "down"
    }
  },
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 获取健康矩阵数据
```http
GET /api/v1/metrics/health-matrix
```

**查询参数**:
```typescript
interface GetHealthMatrixParams {
  departmentId?: string    // 部门ID过滤
  systemId?: string        // 系统ID过滤
  includeAssets?: boolean  // 是否包含资产数据
  groupBy?: 'department' | 'system' | 'asset'  // 分组维度
}
```

### 获取趋势数据
```http
GET /api/v1/metrics/trends
```

**查询参数**:
```typescript
interface GetTrendsParams {
  metrics: string[]        // 指标名称列表
  startTime: string        // 开始时间
  endTime: string          // 结束时间
  interval: string         // 时间间隔
  scope?: string           // 统计范围
  targetId?: string        // 目标ID
}
```

## WebSocket实时接口

### 连接地址
```
ws://api.example.com/ws/v1/realtime
```

### 认证
```javascript
// 连接时携带token
const ws = new WebSocket('ws://api.example.com/ws/v1/realtime?token=Bearer_Token')
```

### 订阅消息格式
```json
{
  "action": "subscribe",
  "topics": [
    "alerts.new",           // 新告警
    "alerts.update",        // 告警状态更新
    "systems.health",       // 系统健康状态变化
    "assets.metrics",       // 资产指标更新
    "kpi.update"           // KPI指标更新
  ],
  "filters": {
    "departmentId": "dept_001",
    "systemId": "sys_001"
  }
}
```

### 推送消息格式
```json
{
  "topic": "alerts.new",
  "data": {
    "id": "alert_new_001",
    "type": "RUNTIME",
    "level": "P1",
    "title": "服务器响应超时",
    "systemName": "公安执法系统",
    "timestamp": "2025-09-28T10:00:00Z"
  },
  "timestamp": "2025-09-28T10:00:00Z"
}
```

### 心跳机制
```json
// 客户端发送
{
  "action": "ping"
}

// 服务端响应
{
  "action": "pong",
  "timestamp": "2025-09-28T10:00:00Z"
}
```

## 错误处理

### 错误码定义
```typescript
enum ErrorCode {
  // 通用错误 (1000-1999)
  INVALID_PARAMETER = 1001,     // 参数错误
  MISSING_PARAMETER = 1002,     // 缺少参数
  INVALID_FORMAT = 1003,        // 格式错误

  // 认证错误 (2000-2999)
  UNAUTHORIZED = 2001,          // 未授权
  TOKEN_EXPIRED = 2002,         // Token过期
  INVALID_TOKEN = 2003,         // Token无效
  PERMISSION_DENIED = 2004,     // 权限不足

  // 业务错误 (3000-3999)
  RESOURCE_NOT_FOUND = 3001,    // 资源不存在
  RESOURCE_CONFLICT = 3002,     // 资源冲突
  BUSINESS_RULE_VIOLATION = 3003, // 业务规则违反

  // 系统错误 (5000-5999)
  INTERNAL_ERROR = 5001,        // 内部错误
  DATABASE_ERROR = 5002,        // 数据库错误
  EXTERNAL_SERVICE_ERROR = 5003, // 外部服务错误
  RATE_LIMIT_EXCEEDED = 5004    // 请求频率超限
}
```

### 错误响应示例
```json
{
  "code": 1001,
  "message": "参数验证失败",
  "data": null,
  "timestamp": "2025-09-28T10:00:00Z",
  "requestId": "req_12345",
  "errors": [
    {
      "field": "departmentId",
      "code": "REQUIRED",
      "message": "部门ID不能为空"
    },
    {
      "field": "pageSize",
      "code": "OUT_OF_RANGE",
      "message": "每页大小必须在1-100之间"
    }
  ]
}
```

### 重试策略
```typescript
interface RetryConfig {
  maxRetries: number        // 最大重试次数
  baseDelay: number        // 基础延迟(ms)
  maxDelay: number         // 最大延迟(ms)
  backoffFactor: number    // 退避因子
  retryableErrors: number[] // 可重试的错误码
}

// 默认重试配置
const defaultRetryConfig: RetryConfig = {
  maxRetries: 3,
  baseDelay: 1000,
  maxDelay: 10000,
  backoffFactor: 2,
  retryableErrors: [5001, 5002, 5003] // 仅系统错误重试
}
```

## 接口测试

### Mock接口配置
当前系统支持Mock模式，可通过以下方式配置：

```typescript
// 环境变量
VITE_ENABLE_MOCK=true
VITE_MOCK_DELAY=500  // 模拟网络延迟

// Mock配置页面
访问 /mock-config 页面进行可视化配置
```

### 接口测试用例
```typescript
// 组织架构测试
describe('Organization API', () => {
  test('获取组织架构树', async () => {
    const response = await api.get('/organizations/tree')
    expect(response.code).toBe(200)
    expect(response.data).toBeInstanceOf(Array)
  })
})

// 告警接口测试
describe('Alert API', () => {
  test('获取告警列表', async () => {
    const params = { type: ['RUNTIME'], status: ['OPEN'] }
    const response = await api.get('/alerts', { params })
    expect(response.data.list).toBeInstanceOf(Array)
  })
})
```

---

## 📚 相关文档
- [功能更新文档](./功能更新文档.md)
- [技术架构文档](./技术架构文档.md)
- [UI-UX设计规范](./UI-UX设计规范.md)
- [产品需求文档PRD](./产品需求文档PRD.md)
- [开发指南](../CLAUDE.md)

---

**接口维护**: 请在系统接口发生变化时及时更新本文档，确保前后端开发人员信息同步