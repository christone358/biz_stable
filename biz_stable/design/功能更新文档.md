# 业务保障系统功能更新文档

## 版本信息
- 版本号：v2.1.0
- 更新日期：2025-09-28
- 更新类型：功能增强
- 状态：已完成实现

## 🎯 核心功能更新

### 1. 界面布局重构 ✅

#### 1.1 三面板布局设计
**原有布局：**
- 左侧：组织树
- 右侧：告警列表（垂直布局）
- 中间：KPI卡片 + 健康矩阵

**新布局：**
```
┌─────────────────────────────────────────────────┐
│                 KPI卡片区域（横向撑满）            │
├─────────┬─────────────────┬─────────────────────┤
│ 组织树  │   健康矩阵图    │   系统详情面板       │
│ (200px) │                │                     │
│         │                │                     │
├─────────┴─────────────────┴─────────────────────┤
│            告警监控面板（横向撑满）                │
└─────────────────────────────────────────────────┘
```

#### 1.2 新增层级结构
原有结构：
```
市大数据中心
├── 市公安局
├── 市民政局
└── ...
```

新增结构：
```
市大数据中心 (根节点)
├── 市公安局 (部门节点)
│   ├── 公安执法系统 (系统节点)
│   │   ├── 服务器-01 (资产节点)
│   │   ├── 数据库-01 (资产节点)
│   │   └── ...
│   └── 公安管理平台 (系统节点)
│       └── ...
└── ...
```

#### 1.3 交互行为升级 ✅
1. **点击根节点**：右侧显示业务系统整体状态列表
2. **点击部门节点**：右侧显示该部门的系统状态（支持列表/卡片视图切换）
3. **点击系统节点**：右侧显示系统详细信息
4. **点击蜂窝图资产**：右侧显示资产详情（带面包屑导航）
5. **矩阵图气泡点击**：支持系统下钻导航

#### 1.4 展开逻辑
- 部门节点：点击展开图标动态加载该部门的业务系统
- 系统节点：点击展开图标显示该系统的所有资产
- 支持展开/折叠状态管理

### 2. 系统详情面板 ✅

#### 2.1 四种显示模式
- **systemsList**: 业务系统概览列表（根节点选择时）
- **departmentSystems**: 部门系统显示（支持列表/卡片视图切换）
- **systemDetail**: 单个系统详细信息
- **assetDetail**: 资产详细信息（带面包屑返回导航）

#### 2.2 面包屑导航
- 系统级别显示：`系统名称`
- 资产级别显示：`系统名称 > 资产名称`
- 支持点击返回上级系统视图

### 3. 告警监控重构 ✅

#### 3.1 三类告警分类
- **运行告警 (RUNTIME)**: 系统运行时异常
- **脆弱性 (VULNERABILITY)**: 安全漏洞信息
- **安全事件 (SECURITY)**: 安全威胁事件

#### 3.2 动态筛选逻辑
- 根据左侧组织树选择范围自动过滤
- 支持实时数据刷新
- 横向标签页展示，每类显示计数

### 4. 数据筛选与统计

#### 4.1 全局数据联动 ✅
根据左侧组织树选择，所有面板实时更新：
- **KPI指标卡**：显示选中范围的统计数据
- **健康矩阵图**：筛选显示对应部门/系统的数据
- **系统详情面板**：动态切换显示模式
- **告警监控面板**：按选择范围筛选三类告警

#### 4.2 蜂窝图选择状态 ✅
- **选择高亮**：点击蜂窝图资产时边框高亮显示
- **状态持久化**：选择状态在Redux中管理
- **自动清除**：返回上级系统时自动清除选择状态
- **视觉反馈**：支持hover和选中的双重视觉效果

#### 4.3 新增资产管理
- **资产类型**：服务器、数据库、网络设备、存储设备、安全设备、应用服务、中间件
- **资产健康状态**：与系统健康状态保持一致
- **资产统计**：新增"异常资产"KPI卡片

### 5. Mock数据配置可视化

#### 5.1 现有功能
- JSON格式编辑mock数据
- 支持组织架构、业务系统、KPI指标等类型
- 启用/禁用配置开关

#### 5.2 计划增强 (待实现)
- 可视化表单替代JSON编辑
- 字段级别的配置界面
- 实时预览功能
- 模板库和快速生成

## 🗂️ 数据结构更新

### 组织节点 (OrganizationNode)
```typescript
interface OrganizationNode {
  id: string
  name: string
  type: 'root' | 'department' | 'system' | 'asset'  // 新增节点类型
  systemCount: number
  assetCount: number  // 新增资产数量
  healthStatus: HealthStatus
  children?: OrganizationNode[]
  level?: number
  parentId?: string
  assets?: Asset[]  // 新增资产列表
  isExpanded?: boolean  // 新增展开状态
}
```

### 资产信息 (Asset)
```typescript
interface Asset {
  id: string
  name: string
  type: string  // 资产类型
  healthStatus: HealthStatus
  importance: ImportanceLevel
  systemId: string
  systemName: string
  departmentId: string
  department: string
  ipAddress?: string
  description?: string
  errorRate: number
  responseTime: number
  availability: number
  alertCount: number
  vulnerabilityCount: number
  lastCheck?: string
  createdAt: string
  updatedAt: string
}
```

### Redux状态更新 ✅
```typescript
interface DashboardState {
  selectedOrganization: OrganizationNode | null
  organizations: OrganizationNode[]
  systems: BusinessSystem[]
  filteredAssets: Asset[]  // 筛选资产
  selectedDepartmentId: string | null  // 选中部门ID
  selectedAssetId: string | null  // 新增：蜂窝图选中资产ID
  metrics: DashboardMetrics | null
  alerts: Alert[]
  vulnerabilities: Vulnerability[]
  filters: FilterOptions
  loading: boolean
  error: string | null
}
```

## 🎨 UI/UX 更新

### 1. 组织树样式
- **层级视觉**：不同层级使用不同的缩进和背景色
- **图标系统**：根节点(文件夹)、部门(文件夹)、系统(数据库)、资产(服务器)
- **状态指示**：健康状态圆点，支持闪烁动画
- **展开动画**：平滑的展开/折叠效果
- **连接线**：树形结构连接线增强视觉层次

### 2. KPI卡片更新
- **第一张卡片**：业务系统总数 + 资产总数
- **第二张卡片**：异常系统统计
- **第三张卡片**：未处理紧急告警
- **第四张卡片**：异常资产统计 (新增)

### 3. 响应式设计
- 移动端隐藏统计数字
- 小屏幕下隐藏图例
- 自适应布局调整

## 🔧 技术实现

### 1. 状态管理
新增Redux Actions：
- `toggleOrganizationExpand`: 切换节点展开状态
- `expandOrganizationNode`: 展开节点并加载子节点
- `setFilteredAssets`: 设置筛选的资产列表
- `setSelectedDepartmentId`: 设置选中的部门ID
- `setSelectedAssetId`: 设置选中的资产ID (新增)

### 2. 数据生成
新增Mock数据生成函数：
- `generateAssetsForSystem`: 为系统生成资产数据
- `generateSystemsForDepartment`: 为部门生成系统节点
- `getAssetsForDepartment`: 获取部门的所有资产
- `getAllAssets`: 获取所有资产

### 3. 组件更新
- **OrganizationTree**: 完全重构，支持多层级交互
- **SystemDetail**: 新增组件，支持4种显示模式
- **AlertPanel**: 重构为横向标签页布局
- **HealthMatrix**: 增强交互和选择状态

## 📍 Mock数据入口

### 访问方式
1. **主导航**：从仪表板页面点击"Mock配置"按钮
2. **直接访问**：浏览器地址栏输入 `/mock-config`
3. **返回仪表板**：配置页面左上角"返回仪表板"按钮

### 功能说明
- **配置管理**：创建、编辑、删除、启用/禁用mock数据配置
- **数据类型**：支持组织架构、业务系统、KPI指标、告警数据、漏洞数据
- **实时预览**：支持预览配置的数据内容
- **JSON编辑**：当前支持JSON格式编辑 (计划升级为可视化界面)

## 🚀 下一步计划

### Phase 1: 界面重构 ✅ 已完成
- [x] 三面板布局重构
- [x] 系统详情面板（4种显示模式）
- [x] 告警监控重构（三类告警）
- [x] 蜂窝图选择状态
- [x] 面包屑导航
- [x] 数据联动优化

### Phase 1.5: 交互增强 ✅ 已完成
- [x] 列表/卡片视图切换
- [x] 矩阵图气泡点击下钻
- [x] 选择状态高亮显示
- [x] 返回导航功能

### Phase 2: Mock配置优化
- [ ] 可视化配置界面
- [ ] 字段级别编辑
- [ ] 模板库功能
- [ ] 批量导入导出

### Phase 3: 功能增强
- [ ] 实时数据推送
- [ ] 历史数据查看
- [ ] 自定义仪表板
- [ ] 权限管理

## 🐛 已解决问题

1. **CSS变量缺失**：页面空白问题，已修复App.css中的CSS自定义属性
2. **图标导入错误**：ShieldOutlined不存在，已替换为SecurityScanOutlined
3. **状态同步问题**：部门选择时错误显示资产详情，已修复选择逻辑

## 📚 相关文档

- [技术架构文档](./技术架构文档.md)
- [UI-UX设计规范](./UI-UX设计规范.md)
- [接口规范文档](./接口规范文档.md)
- [产品需求文档PRD](./产品需求文档PRD.md)
- [开发指南](../CLAUDE.md)