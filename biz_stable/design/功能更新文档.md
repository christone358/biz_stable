# 业务保障系统功能更新文档

## 版本信息
- 版本号：v2.0.0
- 更新日期：2025-09-26
- 更新类型：功能增强

## 🎯 核心功能更新

### 1. 组织机构树交互升级

#### 1.1 新增层级结构
原有结构：
```
市大数据中心
├── 市公安局
├── 市民政局
└── ...
```

新增结构：
```
市大数据中心 (根节点)
├── 市公安局 (部门节点)
│   ├── 公安执法系统 (系统节点)
│   │   ├── 服务器-01 (资产节点)
│   │   ├── 数据库-01 (资产节点)
│   │   └── ...
│   └── 公安管理平台 (系统节点)
│       └── ...
└── ...
```

#### 1.2 交互行为
1. **点击根节点**：显示全部资产和系统统计
2. **点击部门节点**：筛选显示该部门下的所有系统和资产
3. **点击系统节点**：筛选显示该系统下的所有资产
4. **点击资产节点**：显示单个资产的详细信息

#### 1.3 展开逻辑
- 部门节点：点击展开图标动态加载该部门的业务系统
- 系统节点：点击展开图标显示该系统的所有资产
- 支持展开/折叠状态管理

### 2. 数据筛选与统计

#### 2.1 右侧数据联动
根据左侧组织树选择，右侧面板实时更新：
- **KPI指标卡**：显示选中范围的统计数据
- **业务健康矩阵图**：筛选显示对应部门/系统的数据
- **系统状态列表**：筛选显示相关系统
- **告警面板**：筛选显示相关告警

#### 2.2 新增资产管理
- **资产类型**：服务器、数据库、网络设备、存储设备、安全设备、应用服务、中间件
- **资产健康状态**：与系统健康状态保持一致
- **资产统计**：新增"异常资产"KPI卡片

### 3. Mock数据配置可视化

#### 3.1 现有功能
- JSON格式编辑mock数据
- 支持组织架构、业务系统、KPI指标等类型
- 启用/禁用配置开关

#### 3.2 计划增强 (待实现)
- 可视化表单替代JSON编辑
- 字段级别的配置界面
- 实时预览功能
- 模板库和快速生成

## 🗂️ 数据结构更新

### 组织节点 (OrganizationNode)
```typescript
interface OrganizationNode {
  id: string
  name: string
  type: 'root' | 'department' | 'system' | 'asset'  // 新增节点类型
  systemCount: number
  assetCount: number  // 新增资产数量
  healthStatus: HealthStatus
  children?: OrganizationNode[]
  level?: number
  parentId?: string
  assets?: Asset[]  // 新增资产列表
  isExpanded?: boolean  // 新增展开状态
}
```

### 资产信息 (Asset)
```typescript
interface Asset {
  id: string
  name: string
  type: string  // 资产类型
  healthStatus: HealthStatus
  importance: ImportanceLevel
  systemId: string
  systemName: string
  departmentId: string
  department: string
  ipAddress?: string
  description?: string
  errorRate: number
  responseTime: number
  availability: number
  alertCount: number
  vulnerabilityCount: number
  lastCheck?: string
  createdAt: string
  updatedAt: string
}
```

### Redux状态更新
```typescript
interface DashboardState {
  selectedOrganization: OrganizationNode | null
  organizations: OrganizationNode[]
  systems: BusinessSystem[]
  filteredAssets: Asset[]  // 新增筛选资产
  selectedDepartmentId: string | null  // 新增选中部门ID
  metrics: DashboardMetrics | null
  alerts: Alert[]
  vulnerabilities: Vulnerability[]
  filters: FilterOptions
  loading: boolean
  error: string | null
}
```

## 🎨 UI/UX 更新

### 1. 组织树样式
- **层级视觉**：不同层级使用不同的缩进和背景色
- **图标系统**：根节点(文件夹)、部门(文件夹)、系统(数据库)、资产(服务器)
- **状态指示**：健康状态圆点，支持闪烁动画
- **展开动画**：平滑的展开/折叠效果
- **连接线**：树形结构连接线增强视觉层次

### 2. KPI卡片更新
- **第一张卡片**：业务系统总数 + 资产总数
- **第二张卡片**：异常系统统计
- **第三张卡片**：未处理紧急告警
- **第四张卡片**：异常资产统计 (新增)

### 3. 响应式设计
- 移动端隐藏统计数字
- 小屏幕下隐藏图例
- 自适应布局调整

## 🔧 技术实现

### 1. 状态管理
新增Redux Actions：
- `toggleOrganizationExpand`: 切换节点展开状态
- `expandOrganizationNode`: 展开节点并加载子节点
- `setFilteredAssets`: 设置筛选的资产列表
- `setSelectedDepartmentId`: 设置选中的部门ID

### 2. 数据生成
新增Mock数据生成函数：
- `generateAssetsForSystem`: 为系统生成资产数据
- `generateSystemsForDepartment`: 为部门生成系统节点
- `getAssetsForDepartment`: 获取部门的所有资产
- `getAllAssets`: 获取所有资产

### 3. 组件更新
- **OrganizationTree**: 完全重构，支持多层级交互
- **KPICards**: 动态计算选中范围的统计数据
- **HealthMatrix**: 根据筛选条件显示对应数据

## 📍 Mock数据入口

### 访问方式
1. **主导航**：从仪表板页面点击"Mock配置"按钮
2. **直接访问**：浏览器地址栏输入 `/mock-config`
3. **返回仪表板**：配置页面左上角"返回仪表板"按钮

### 功能说明
- **配置管理**：创建、编辑、删除、启用/禁用mock数据配置
- **数据类型**：支持组织架构、业务系统、KPI指标、告警数据、漏洞数据
- **实时预览**：支持预览配置的数据内容
- **JSON编辑**：当前支持JSON格式编辑 (计划升级为可视化界面)

## 🚀 下一步计划

### Phase 1: 基础功能完善
- [x] 组织树层级交互
- [x] 数据筛选联动
- [x] 新增资产管理
- [x] KPI统计更新

### Phase 2: Mock配置优化
- [ ] 可视化配置界面
- [ ] 字段级别编辑
- [ ] 模板库功能
- [ ] 批量导入导出

### Phase 3: 功能增强
- [ ] 实时数据推送
- [ ] 历史数据查看
- [ ] 自定义仪表板
- [ ] 权限管理

## 🐛 已知问题

1. **性能优化**：大量资产数据时的渲染性能待优化
2. **数据同步**：Mock数据变更后的状态同步
3. **错误处理**：网络异常时的友好提示

## 📚 相关文档

- [技术设计文档](./技术设计文档.md)
- [UI-UX设计文档](./UI-UX设计文档.md)
- [README使用说明](../README.md)