# 脆弱性管理功能设计文档

## 1. 功能概述

脆弱性管理功能是业务保障管理系统的核心功能模块，面向业务管理部门，提供全局视角的安全脆弱性监测、统计和协同处置能力。该功能由两个主要页面组成：脆弱性总览和脆弱性管理。

### 核心目标
- 通过可视化统计展示全局脆弱性风险态势
- 识别高风险业务系统和处置效率低下的运维单位
- 提供多维度脆弱性检索和筛选能力
- 支持脆弱性协同处置任务的派发和跟踪

## 2. 页面架构

### 2.1 整体结构
```
脆弱性管理页面
├── Tabs切换（顶部）
│   ├── 脆弱性总览 (Overview)
│   └── 脆弱性管理 (Management)
```

### 2.2 脆弱性总览页面 (Overview)

#### 布局结构
```
┌─────────────────────────────────────────┐
│  KPI指标卡片（4个横向排列，可点击下钻）    │
├─────────────────────────────────────────┤
│  表格区域（2列布局）                      │
│  ├── 业务系统脆弱性TOP5                   │
│  └── 运维单位处置效率TOP5                 │
├─────────────────────────────────────────┤
│  图表区域（2列布局）                      │
│  ├── 脆弱性变化趋势（折线图）             │
│  └── 风险等级分布（环形图）               │
└─────────────────────────────────────────┘
```

#### 功能模块说明

**1. KPI指标卡片**
- 总脆弱性数量：展示全局脆弱性总数及周同比趋势
- 待处置脆弱性：展示待处置数量及趋势
- 高危脆弱性：展示高危漏洞数量及趋势
- 未确认资产脆弱性：点击打开模态框查看未确认资产详情

**2. 业务系统脆弱性TOP5表格**
- 展示字段：业务系统名称、脆弱性数量、高危数量、风险趋势、状态标签
- 交互：点击行可下钻到管理页面并自动筛选该系统

**3. 运维单位处置效率TOP5表格**
- 展示字段：责任单位、总任务数、已处置数、修复率、效率分（进度条+分值）
- 效率分颜色规则：>=80绿色，60-79黄色，<60红色

**4. 脆弱性变化趋势图表**
- 类型：多系列折线图
- 支持时间周期切换：近一周、近一月、近一季度
- 展示4类脆弱性的数量变化：主机漏洞、Web漏洞、配置缺陷、弱口令

**5. 风险等级分布图表**
- 类型：环形饼图
- 展示高危、中危、低危、信息4个等级的占比
- 颜色映射：高危红色(#f5222d)、中危橙色(#fa8c16)、低危绿色(#52c41a)、信息蓝色(#1890ff)

### 2.3 脆弱性管理页面 (Management)

#### 布局结构
```
┌───────┬─────────────────────────────┐
│       │  操作栏（搜索筛选+批量操作）   │
│ 维度  ├─────────────────────────────┤
│ 树形  │                             │
│ 筛选  │  脆弱性列表表格               │
│ 280px │  （支持分页、行选择、操作）    │
│       │                             │
└───────┴─────────────────────────────┘
```

#### 功能模块说明

**1. 维度树形筛选（左侧固定280px宽度）**
- 维度切换：支持3种维度（业务系统、归属单位、脆弱性类型）
- 搜索框：支持关键字搜索树节点
- 树结构：
  - "全部"节点（显示总数）
  - 各维度子节点（显示该节点下的脆弱性数量）
- 交互：单选模式，点击节点自动过滤右侧表格数据

**2. 操作栏**
- 筛选控件：
  - 搜索框：支持脆弱性名称、CVE编号搜索
  - 风险等级下拉框：全部/高危/中危/低危/信息
  - 状态下拉框：全部/待处理/处理中/已解决/已超期
  - 业务系统下拉框：全部系统列表
- 操作按钮：
  - 查询：触发筛选
  - 重置：清空筛选条件
  - 批量派发：对选中的记录批量派发任务
  - 导出数据：导出当前筛选结果

**3. 脆弱性列表表格**
- 展示字段：
  - 复选框：支持多选
  - 脆弱性名称
  - CVE编号
  - 风险等级（标签）
  - 业务系统
  - 发现时间
  - 状态（标签）
  - 操作列（固定右侧）
- 行操作：
  - 查看详情：打开右侧抽屉显示完整信息
  - 派发任务/重新派发：打开派发任务模态框
- 分页：支持每页显示条数切换，快速跳转

## 3. 交互流程

### 3.1 下钻导航流程
```
总览页KPI卡片点击
    ↓
切换到管理页面
    ↓
自动应用筛选条件
    ↓
展示过滤后的脆弱性列表
```

### 3.2 脆弱性处置流程
```
选择脆弱性记录
    ↓
点击"派发任务"
    ↓
填写派发表单
  - 责任单位
  - 处理人
  - 优先级
  - 完成时间
  - 处理说明
    ↓
提交派发
    ↓
系统记录处置任务
```

### 3.3 未确认资产处理流程
```
总览页点击"未确认资产脆弱性"卡片
    ↓
打开模态框显示未确认资产列表
    ↓
对每条记录操作
  - 确认：将资产纳入管理
  - 忽略：标记为误报
    ↓
批量处理或逐条处理
```

## 4. 数据模型

### 4.1 核心类型定义

**VulnerabilityRecord（脆弱性记录）**
```typescript
{
  id: string                    // 脆弱性ID
  name: string                  // 脆弱性名称
  cveNumber: string             // CVE编号
  level: VulnerabilityLevel     // 风险等级（high/medium/low/info）
  cvssScore: number             // CVSS评分
  businessSystem: string        // 业务系统
  assetName: string             // 资产名称
  ipAddress: string             // IP地址
  discoveredTime: string        // 发现时间
  status: VulnerabilityStatus   // 状态（pending/processing/resolved/overdue）
  assignee: string | null       // 处置责任人
  department: string            // 责任单位
  description: string           // 漏洞描述
  affectedScope: string         // 影响范围
  fixSuggestion: string         // 修复建议
  processingRecords: Array      // 处理记录
}
```

**TreeNode（树节点）**
```typescript
{
  id: string          // 节点ID
  name: string        // 节点名称
  count: number       // 该节点下的脆弱性数量
  checked: boolean    // 是否选中
}
```

### 4.2 状态管理

**筛选条件状态**
```typescript
{
  keyword: string                       // 搜索关键字
  level: VulnerabilityLevel | 'all'    // 风险等级
  status: VulnerabilityStatus | 'all'  // 状态
  businessSystem: string | 'all'       // 业务系统
  dimension: DimensionType             // 当前维度
  selectedTreeNode: string | null      // 选中的树节点ID
}
```

## 5. 技术实现

### 5.1 技术栈
- **UI框架**: React 18 + TypeScript
- **组件库**: Ant Design 5.x
- **图表库**: ECharts 5.x + echarts-for-react
- **路由**: React Router v6
- **状态管理**: React Hooks (useState, useMemo, useCallback)

### 5.2 组件结构
```
pages/management/vulnerability/
├── index.tsx                    # 主入口，Tabs切换
├── index.css                    # 主入口样式
├── types.ts                     # TypeScript类型定义
├── components/
│   ├── Overview.tsx            # 脆弱性总览组件
│   ├── Overview.css            # 总览组件样式
│   ├── Management.tsx          # 脆弱性管理组件
│   ├── Management.css          # 管理组件样式
│   ├── DimensionTree.tsx       # 维度树形筛选组件
│   └── DimensionTree.css       # 树形筛选样式
```

### 5.3 Mock数据
```
mock/vulnerability-data.ts
├── generateVulnerabilityMetrics()          # KPI指标
├── generateSystemVulnerabilityStats()      # 业务系统统计
├── generateDepartmentEfficiencyStats()     # 部门效率统计
├── generateTrendData()                     # 趋势数据
├── generateRiskDistribution()              # 风险分布
├── generateTreeNodes()                     # 树节点数据
├── generateVulnerabilityRecords()          # 脆弱性记录
└── generateUnconfirmedAssetVulnerabilities() # 未确认资产
```

### 5.4 ECharts配置

**趋势图配置要点**
- 使用line类型，启用smooth平滑曲线
- 4个系列对应4类脆弱性
- 使用默认调色板
- 支持tooltip和legend交互

**环形图配置要点**
- 使用pie类型，设置innerRadius形成环形
- 自定义颜色映射到风险等级
- 悬停时显示详细信息
- 隐藏label，使用legend显示分类

## 6. UI/UX规范遵循

### 6.1 颜色系统
- 主色调：#1890FF（品牌蓝）
- 成功色：#52C41A（绿色）
- 警告色：#FAAD14（橙色）
- 错误色：#FF4D4F（红色）
- 信息色：#1890FF（蓝色）

### 6.2 间距规范
- 页面padding: 24px
- 卡片间距: 16px
- 组件内间距: 16px/24px
- 表单控件高度: 36px

### 6.3 响应式设计
- 大屏(>=1200px): 2列布局
- 中屏(768-1199px): 自适应布局，树形筛选宽度100%
- 小屏(<768px): 单列布局，表格横向滚动

### 6.4 交互规范
- 卡片hover效果: translateY(-4px) + 阴影增强
- 按钮最小宽度: 96px
- 表格行hover: 背景色#f5f5f5
- 链接颜色: #1890FF，hover下划线

## 7. 性能优化

### 7.1 React性能优化
- 使用useMemo缓存筛选后的数据
- 使用useCallback缓存事件处理函数
- 避免不必要的重渲染

### 7.2 数据加载优化
- 表格启用虚拟滚动（大数据量时）
- 图表懒加载，页面可见时才渲染
- 分页减少单次渲染数据量

## 8. 测试检查清单

### 8.1 功能测试
- [ ] KPI卡片点击下钻到管理页面
- [ ] 表格行点击下钻到管理页面
- [ ] 维度切换正确加载树节点
- [ ] 树节点选择正确过滤表格
- [ ] 多条件组合筛选正确
- [ ] 查看详情抽屉正确显示数据
- [ ] 派发任务表单验证正确
- [ ] 批量派发选择校验
- [ ] 未确认资产模态框交互

### 8.2 UI测试
- [ ] 不同屏幕尺寸布局正确
- [ ] 卡片悬停效果
- [ ] 标签颜色映射正确
- [ ] 进度条颜色分级正确
- [ ] 图表渲染完整

### 8.3 边界测试
- [ ] 空数据状态展示
- [ ] 长文本省略处理
- [ ] 表单必填项验证
- [ ] 搜索无结果提示

## 9. 后续扩展

### 9.1 功能增强
- 添加脆弱性导入导出功能
- 支持脆弱性批量确认
- 添加处置进度跟踪看板
- 集成实时告警推送

### 9.2 数据分析增强
- 添加脆弱性生命周期分析
- 提供修复时效性统计
- 支持自定义报表生成
- 添加部门协同效率对比

## 10. 注意事项

1. **类型安全**: 所有组件props和state必须定义TypeScript类型
2. **代码复用**: 公共逻辑提取为自定义Hook
3. **错误处理**: 表单提交、数据加载需要完善错误处理
4. **无障碍**: 为图标按钮添加aria-label
5. **SEO友好**: 页面标题和meta信息完整
6. **安全性**: 避免XSS，对用户输入进行sanitize
7. **国际化预留**: 文案预留i18n接入点

## 11. 文件清单

已创建的文件：
- `/src/pages/management/vulnerability/index.tsx` - 主入口
- `/src/pages/management/vulnerability/index.css` - 主入口样式
- `/src/pages/management/vulnerability/types.ts` - 类型定义
- `/src/pages/management/vulnerability/components/Overview.tsx` - 总览组件
- `/src/pages/management/vulnerability/components/Overview.css` - 总览样式
- `/src/pages/management/vulnerability/components/Management.tsx` - 管理组件
- `/src/pages/management/vulnerability/components/Management.css` - 管理样式
- `/src/pages/management/vulnerability/components/DimensionTree.tsx` - 树形筛选
- `/src/pages/management/vulnerability/components/DimensionTree.css` - 树形筛选样式
- `/src/mock/vulnerability-data.ts` - Mock数据生成器

修改的文件：
- `/src/App.tsx` - 添加路由配置

新增依赖：
- `echarts@^5.6.0`
- `echarts-for-react@^3.0.2`
