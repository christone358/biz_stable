# 业务板块管理功能设计文档

## 文档说明
本文档从产品和架构角度描述业务板块管理功能的设计思路、功能组织和交互逻辑。

**最后更新时间**: 2025-10-15
**开发状态**: 已完成
**对应页面**: `/src/pages/business-management/`
**路由路径**: `/management/business-management`

---

## 1. 功能概述

### 1.1 业务背景

业务板块管理是系统的基础数据管理功能，用于维护组织的业务架构信息。这是一个"源头"功能，其数据会被业务全景、资产管理、告警监测等多个模块引用。准确完整的业务板块数据是整个系统正常运行的基础。

### 1.2 核心目标

1. **结构化管理**: 维护三级业务架构（业务板块 → 业务分类 → 应用系统）
2. **信息完整性**: 记录每个业务实体的详细属性和元数据
3. **变更可追溯**: 支持编辑和版本管理，保证数据质量
4. **数据导入导出**: 支持批量维护，提高效率

### 1.3 用户角色

- **业务架构师**: 规划和维护整体业务架构
- **系统管理员**: 录入和更新业务系统信息
- **项目经理**: 查看业务板块和系统的组织关系

---

## 2. 用户场景

### 场景1：新增业务板块

张架构师规划新的业务板块：
1. 打开业务板块管理页面
2. 点击页面右上角"新建板块"按钮
3. 在弹出表单中填写：
   - 板块名称：六基
   - 板块编号：BASE-06
   - 负责单位：技术保障中心
   - 板块描述：基础技术支撑服务
4. 保存后，左侧树自动展开新增的板块
5. 选中新板块，右侧显示板块详情
6. 在板块下新增二级分类"基础组件"
7. 在分类下新增应用系统"统一日志平台"

### 场景2：编辑应用系统信息

李管理员更新应用信息：
1. 在左侧树中找到"统一身份认证"应用
2. 点击选中，右侧显示应用详情
3. 点击右上角"编辑"按钮
4. 进入编辑模式，修改以下字段：
   - 负责人：从"张三"改为"李四"
   - 技术栈：添加"Redis"
   - 部署架构：更新为"K8s集群"
5. 点击"保存"，数据更新成功
6. 系统记录变更历史（时间、操作人、变更内容）

### 场景3：批量导入业务数据

王经理需要批量录入50个应用系统：
1. 点击"导入"按钮
2. 下载Excel模板
3. 按模板格式填写应用信息
4. 上传填写好的Excel文件
5. 系统校验数据格式和必填项
6. 预览导入结果（成功/失败条数）
7. 确认导入，系统批量写入数据库
8. 左侧树刷新，显示新增的应用系统

---

## 3. 页面布局设计

### 3.1 整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 业务板块与应用管理        [导入] [导出] [新建板块]              │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┬──────────────────────────────────────────────────┐
│              │                                                    │
│  业务架构树  │                  详情面板                          │
│  (300px)     │                                                    │
│              │  ┌──────────────────────────────────────────────┐│
│  [搜索框]    │  │ 统一身份认证系统                [编辑]        ││
│              │  └──────────────────────────────────────────────┘│
│  一梁        │                                                    │
│  ├─ 一网通办 │  【基本信息】                                      │
│  │  ├─ PC门户│  系统名称：统一身份认证系统                        │
│  │  └─ APP  │  系统编号：AUTH-001                               │
│  ├─ 随申办   │  所属板块：四柱 > 基础服务                         │
│  └─ 小程序   │  负责单位：基础架构组                              │
│              │  负责人：  张三                                    │
│  四柱        │                                                    │
│  ├─ 统一支付 │  【技术信息】                                      │
│  ├─ 身份认证 │  技术栈：  Java, Spring Boot, Redis               │
│  │  ├─ Web端│  数据库：  MySQL, MongoDB                         │
│  │  └─ 移动端│  部署方式：K8s集群                                 │
│  ├─ 统一客服 │  服务地址：https://auth.example.com               │
│  └─ 统一物流 │                                                    │
│              │  【运维信息】                                      │
│  一库        │  上线时间：2021-03-15                             │
│  ├─ 公共信息 │  最近更新：2024-10-10                             │
│  ├─ 人口信息 │  运维状态：运行中                                  │
│  └─ 地理信息 │                                                    │
│              │  【接口信息】                                      │
│  多应用      │  API文档：  [链接]                                │
│  ├─ 企业开办 │  监控面板：[链接]                                 │
│  └─ ...      │  日志平台：[链接]                                 │
│              │                                                    │
└──────────────┴──────────────────────────────────────────────────┘
```

### 3.2 功能区域划分

**顶部工具栏**
- 页面标题：业务板块与应用管理
- 导入按钮：批量导入业务数据
- 导出按钮：导出当前业务架构到Excel
- 新建板块按钮：创建新的一级业务板块

**左侧业务架构树（300px固定宽度）**
- 搜索框：快速定位业务实体
- 三级树形结构：板块 → 分类 → 应用
- 支持展开/折叠
- 选中节点高亮显示
- 显示节点类型图标

**右侧详情面板（自适应宽度）**
- 标题栏：实体名称 + 编辑按钮
- 基本信息区：业务属性和组织关系
- 技术信息区：技术栈和架构信息
- 运维信息区：生命周期和状态
- 接口信息区：外部链接和关联资源

---

## 4. 核心功能设计

### 4.1 业务架构树

**设计目标**: 清晰展示三级业务架构关系

**三级结构定义**:
```
Level 1 - 业务板块（6个）
  ├─ 一梁：面向公众的前端入口
  ├─ 四柱：统一公共服务
  ├─ 一库：公共数据库
  ├─ 多应用：主题式服务
  ├─ N项：特色应用
  └─ 六基：基础支撑

Level 2 - 业务分类（按业务领域划分）
  ├─ 四柱 → 统一公共支付
  ├─ 四柱 → 统一身份认证
  └─ 四柱 → 统一客服
  ...

Level 3 - 应用系统（具体的系统实例）
  ├─ 统一身份认证 → Web端认证系统
  ├─ 统一身份认证 → 移动端认证系统
  └─ ...
```

**树节点图标**:
- 📁 业务板块：文件夹图标（蓝色）
- 📂 业务分类：文件夹图标（灰色）
- 🖥️ 应用系统：应用图标（绿色）

**交互设计**:
- **点击节点**: 右侧显示详情
- **右键菜单**: 新增子级、编辑、删除
- **拖拽排序**: 调整同级节点顺序（可选功能）
- **搜索高亮**: 输入关键字，匹配的节点高亮并自动展开

**搜索逻辑**:
- 支持模糊匹配
- 搜索范围：名称、编号、负责人、技术栈
- 实时过滤，输入即搜索
- 展开匹配节点的父级路径

### 4.2 详情面板

**设计目标**: 结构化展示业务实体的完整信息

**信息分组原则**:
1. **基本信息**: 业务属性和组织关系（必填项）
2. **技术信息**: 技术实现和架构细节（可选）
3. **运维信息**: 生命周期和运维状态（必填项）
4. **接口信息**: 外部链接和集成信息（可选）

**字段设计**:

**基本信息**:
- 系统名称（必填）：中文全称
- 系统编号（必填）：唯一标识，如 AUTH-001
- 系统简称（可选）：便于日常称呼
- 所属板块（必填）：自动从树结构获取
- 负责单位（必填）：运维责任单位
- 负责人（必填）：主要联系人
- 联系方式（可选）：电话/邮箱
- 系统描述（必填）：业务功能说明

**技术信息**:
- 技术栈（可选）：开发语言、框架、中间件
- 数据库（可选）：使用的数据库类型和版本
- 部署方式（可选）：物理机/虚拟机/容器/云原生
- 服务地址（可选）：生产环境URL
- 代码仓库（可选）：Git仓库地址
- 架构文档（可选）：文档链接或附件

**运维信息**:
- 上线时间（必填）：首次投产日期
- 最近更新（系统自动）：最后一次修改时间
- 运维状态（必填）：运行中/维护中/已下线
- 重要性等级（必填）：关键/重要/一般/试点
- SLA要求（可选）：可用性承诺
- 灾备方案（可选）：是否有容灾备份

**接口信息**:
- API文档链接：接口文档地址
- 监控面板链接：APM监控系统地址
- 日志平台链接：日志查询系统地址
- 配置中心链接：配置管理平台地址

**显示模式**:
- **查看模式**: 只读展示，字段标签在左，内容在右
- **编辑模式**: 表单输入，支持验证和保存
- 模式切换动画流畅，保持布局稳定

### 4.3 编辑功能

**设计目标**: 提供便捷的数据维护能力

**编辑流程**:
```
1. 选中树节点
   ↓
2. 右侧显示详情（查看模式）
   ↓
3. 点击"编辑"按钮
   ↓
4. 切换到编辑模式
   • 标题栏变为：[保存] [取消]
   • 字段变为表单输入
   • 必填项标红色星号
   ↓
5. 修改字段值
   ↓
6. 点击"保存"
   • 前端表单验证
   • 提交到后端
   • 成功后切换回查看模式
   • 树节点名称同步更新
   ↓
7. 或点击"取消"
   • 放弃修改
   • 恢复原始值
   • 切换回查看模式
```

**表单验证**:
- 必填项为空：红色边框 + 错误提示
- 系统编号重复：提示已存在
- URL格式错误：提示格式不正确
- 日期范围错误：上线时间不能晚于当前

**防误操作**:
- 编辑中切换节点：弹窗确认是否保存
- 关闭页面时有未保存修改：浏览器弹窗提示
- 删除操作：二次确认弹窗

### 4.4 新增功能

**设计目标**: 快速创建新的业务实体

**新增板块流程**:
```
1. 点击"新建板块"按钮
   ↓
2. 弹出模态框
   • 标题：新建业务板块
   • 表单字段：
     - 板块名称（必填）
     - 板块编号（必填）
     - 负责单位（必填）
     - 板块描述（必填）
   ↓
3. 填写并提交
   ↓
4. 左侧树新增节点
   ↓
5. 自动选中新节点，右侧显示详情
```

**新增分类/应用流程**:
```
1. 右键点击父级节点
   ↓
2. 选择"新增子级"
   ↓
3. 弹出模态框（根据父级类型显示不同字段）
   ↓
4. 填写并提交
   ↓
5. 树节点展开，显示新增项
```

**层级约束**:
- 一级节点（板块）：最多6个，不可超过
- 二级节点（分类）：每个板块下无限制
- 三级节点（应用）：每个分类下无限制
- 不允许超过三级深度

### 4.5 导入导出功能

**设计目标**: 支持批量数据维护，提高效率

**导出功能**:
- **触发**: 点击"导出"按钮
- **数据范围**:
  - 未选中节点：导出全部数据
  - 选中板块：导出该板块下所有数据
  - 选中分类：导出该分类下所有应用
- **导出格式**: Excel（.xlsx）
- **表结构**:
  - Sheet1：业务板块
  - Sheet2：业务分类
  - Sheet3：应用系统（包含所有字段）
- **文件命名**: 业务架构_YYYYMMDD_HHMMSS.xlsx

**导入功能**:
```
1. 点击"导入"按钮
   ↓
2. 弹出导入向导
   • 步骤1：下载模板
   • 步骤2：上传文件
   • 步骤3：数据校验
   • 步骤4：确认导入
   ↓
3. 下载Excel模板
   • 包含表头和字段说明
   • 提供示例数据
   ↓
4. 填写模板并上传
   ↓
5. 系统校验数据
   • 必填项检查
   • 格式验证
   • 重复性检查
   • 关联性检查（父级是否存在）
   ↓
6. 展示校验结果
   • 成功：绿色，可导入
   • 失败：红色，显示错误原因
   • 预览导入数据
   ↓
7. 确认导入
   • 批量写入数据库
   • 显示进度条
   • 导入完成后刷新树
```

**错误处理**:
- 部分数据失败：成功的数据正常导入，失败的返回错误清单
- 全部数据失败：不导入任何数据，返回错误报告
- 错误报告可下载，便于修正后重新导入

---

## 5. 数据设计

### 5.1 数据模型（逻辑层面）

**业务板块表（BusinessDomain）**:
- id: 唯一标识
- name: 板块名称
- code: 板块编号
- responsibleUnit: 负责单位
- description: 板块描述
- sortOrder: 排序序号
- createTime: 创建时间
- updateTime: 更新时间

**业务分类表（BusinessCategory）**:
- id: 唯一标识
- domainId: 所属板块ID（外键）
- name: 分类名称
- code: 分类编号
- description: 分类描述
- sortOrder: 排序序号
- createTime: 创建时间
- updateTime: 更新时间

**应用系统表（ApplicationSystem）**:
- id: 唯一标识
- categoryId: 所属分类ID（外键）
- name: 系统名称
- code: 系统编号
- shortName: 系统简称
- responsibleUnit: 负责单位
- responsiblePerson: 负责人
- contactInfo: 联系方式
- description: 系统描述
- techStack: 技术栈（JSON）
- database: 数据库（JSON）
- deploymentMode: 部署方式
- serviceUrl: 服务地址
- codeRepository: 代码仓库
- architectureDoc: 架构文档
- launchDate: 上线时间
- operationStatus: 运维状态
- importanceLevel: 重要性等级
- slaRequirement: SLA要求
- disasterRecovery: 灾备方案
- apiDocUrl: API文档链接
- monitorUrl: 监控面板链接
- logUrl: 日志平台链接
- configUrl: 配置中心链接
- createTime: 创建时间
- updateTime: 更新时间
- updatedBy: 最后更新人

**变更历史表（ChangeHistory）**:
- id: 唯一标识
- entityType: 实体类型（板块/分类/应用）
- entityId: 实体ID
- changeType: 变更类型（新增/修改/删除）
- changeFields: 变更字段（JSON）
- oldValues: 变更前值（JSON）
- newValues: 变更后值（JSON）
- operator: 操作人
- operateTime: 操作时间
- remark: 备注

### 5.2 数据流转

```
页面加载
    ↓
1. 加载业务架构树数据
   • 查询所有板块
   • 默认展开一级节点
   • 二级和三级节点懒加载
    ↓
2. 选中默认节点（第一个板块）
    ↓
3. 加载节点详情数据
   • 根据节点类型查询对应表
   • 关联查询父级和子级数量
    ↓
4. 渲染详情面板
```

**树节点懒加载策略**:
- 板块节点首次展开时，加载其下的分类列表
- 分类节点首次展开时，加载其下的应用列表
- 减少首屏数据量，提升加载速度

**数据缓存策略**:
- 已加载的节点数据缓存在Redux中
- 切换节点时优先读取缓存
- 编辑保存后清除相关缓存，重新加载

---

## 6. 交互设计

### 6.1 树节点操作

**左键点击**:
- 单击：选中节点，显示详情
- 双击：展开/折叠节点

**右键菜单**（根据节点类型显示不同选项）:
- 板块节点：新增分类、编辑板块、删除板块
- 分类节点：新增应用、编辑分类、删除分类
- 应用节点：编辑应用、删除应用、复制应用

**拖拽操作**（可选功能）:
- 同级节点：拖拽排序
- 跨级拖拽：不支持（避免误操作）

### 6.2 搜索交互

```
用户输入关键字
    ↓
实时过滤树节点（防抖300ms）
    ↓
匹配逻辑:
  • 名称包含关键字
  • 编号包含关键字
  • 负责人包含关键字
    ↓
高亮显示匹配节点
    ↓
自动展开匹配节点的父级路径
    ↓
不匹配的节点灰色显示或隐藏（可配置）
```

**清空搜索**:
- 点击搜索框的清空按钮
- 恢复树的原始展开状态
- 保持当前选中节点

### 6.3 编辑模式切换

**进入编辑模式**:
- 点击"编辑"按钮
- 详情面板平滑过渡到编辑状态
- 标题栏按钮变为"保存"和"取消"
- 所有字段变为可编辑状态

**退出编辑模式**:
- 保存成功：自动退出，显示成功提示
- 点击取消：弹窗确认，退出编辑
- 切换节点：弹窗提示"是否保存修改"

**编辑中的提示**:
- 字段实时验证，错误即时显示
- 保存按钮在有修改且无错误时才可点击
- 页面右上角显示"编辑中"状态标识

---

## 7. 架构设计决策

### 7.1 为什么采用三级结构？

**决策**: 板块 → 分类 → 应用，固定三级

**原因**:
1. **业务对齐**: 符合"一网通办"实际的组织架构
2. **深度适中**: 三级既能表达层次，又不会过于复杂
3. **认知负担**: 超过三级，用户难以记忆和定位
4. **技术简化**: 固定层级简化树的实现和数据模型

**对比方案**:
- 无限层级：灵活但复杂，容易失控
- 两级：表达能力不足，分类不够细
- 四级及以上：过于复杂，用户难以理解

### 7.2 为什么详情面板支持编辑模式？

**决策**: 查看和编辑共用一个面板，通过模式切换

**原因**:
1. **空间效率**: 避免多个面板同时占用空间
2. **上下文连续**: 编辑时能看到完整的信息
3. **交互自然**: 从查看到编辑只需点击一个按钮
4. **开发维护**: 一套布局，减少代码重复

**对比方案**:
- 弹窗编辑：空间独立但遮挡信息
- 侧边抽屉：动画复杂，移动端体验差
- 独立编辑页：需要路由跳转，割裂感强

### 7.3 为什么支持导入导出？

**决策**: 提供Excel格式的批量导入导出功能

**原因**:
1. **效率提升**: 批量维护比逐个录入快数十倍
2. **数据迁移**: 便于从旧系统迁移数据
3. **离线编辑**: 用户可以离线准备数据后批量导入
4. **用户习惯**: Excel是业务人员熟悉的工具

**实现考虑**:
- 提供标准模板，降低学习成本
- 严格数据校验，保证数据质量
- 错误反馈清晰，便于修正

### 7.4 为什么需要变更历史？

**决策**: 记录所有增删改操作的变更历史

**原因**:
1. **数据追溯**: 了解业务架构的演变过程
2. **问题排查**: 出现问题时追溯到变更操作
3. **审计合规**: 满足审计要求，操作可追踪
4. **撤销回滚**: 未来可扩展为支持数据回滚

**记录内容**:
- 变更时间和操作人
- 变更前后的字段值对比
- 变更类型（新增/修改/删除）

---

## 8. 视觉设计

### 8.1 树节点样式

**节点类型标识**:
- 📁 板块：蓝色文件夹图标 + 粗体字
- 📂 分类：灰色文件夹图标 + 常规字体
- 🖥️ 应用：绿色应用图标 + 常规字体

**节点状态**:
- 默认：黑色文字
- 悬停：浅蓝色背景
- 选中：蓝色背景 + 白色文字
- 搜索匹配：黄色高亮标记

**树的缩进**:
- 一级缩进：12px
- 每增加一级：+20px

### 8.2 详情面板样式

**信息分组**:
- 每个分组使用Card组件
- 分组标题：14px，粗体，深灰色
- 分组间距：24px

**字段布局**:
- 标签在左，内容在右
- 标签宽度：120px，右对齐
- 内容区域：自适应宽度

**编辑模式**:
- 必填项标签带红色星号
- 输入框边框蓝色聚焦效果
- 错误提示红色文字，显示在字段下方

### 8.3 按钮样式

**主要操作**:
- 新建板块：主色调按钮（蓝色）
- 保存：主色调按钮（蓝色）
- 导入导出：次要按钮（白色边框）

**次要操作**:
- 编辑：链接按钮（文字按钮）
- 取消：默认按钮（灰色边框）
- 删除：危险按钮（红色文字）

---

## 9. 扩展性设计

### 9.1 功能扩展

**当前功能**: 基础的增删改查

**扩展方向**:
1. **版本管理**: 支持数据版本控制和回滚
2. **变更审批**: 重要系统的变更需要审批流程
3. **标签管理**: 为系统打标签（如：云原生、微服务）
4. **关系图谱**: 可视化展示系统间的依赖关系
5. **生命周期管理**: 系统从规划、开发、上线到下线的全流程
6. **健康度评估**: 根据文档完整性、更新频率等计算健康分
7. **智能推荐**: 根据技术栈推荐相关系统或最佳实践

### 9.2 数据扩展

**当前字段**: 基础元数据

**扩展方向**:
1. **自定义字段**: 允许组织添加专属字段
2. **附件管理**: 上传架构图、文档等附件
3. **关联资产**: 关联CMDB中的物理资产
4. **关联项目**: 关联项目管理系统中的项目
5. **成本信息**: 记录系统的运维成本
6. **KPI指标**: 记录系统的业务指标和SLA

### 9.3 集成扩展

**当前状态**: 独立系统

**集成方向**:
1. **CMDB集成**: 从CMDB同步资产信息
2. **代码仓库集成**: 从GitLab/GitHub同步仓库信息
3. **监控系统集成**: 从监控系统获取实时状态
4. **工单系统集成**: 关联运维工单
5. **审批流集成**: 接入审批工作流引擎

---

## 10. 性能考虑

### 10.1 树加载优化

**策略**:
1. 首屏只加载一级节点（板块列表）
2. 二三级节点懒加载，首次展开时加载
3. 已加载的节点数据缓存在内存
4. 搜索时使用防抖，避免频繁请求

### 10.2 详情加载优化

**策略**:
1. 切换节点时优先读取缓存
2. 复杂字段（如变更历史）延迟加载
3. 关联数据（如子节点数量）异步加载

### 10.3 大数据量处理

**场景**: 如果应用系统数量超过1000个

**优化**:
1. 树使用虚拟滚动，只渲染可视区域节点
2. 搜索结果分页显示
3. 导出时限制最大导出数量
4. 后端分页查询，前端按需加载

---

## 11. 安全考虑

### 11.1 权限控制

**操作权限**:
- 查看权限：所有登录用户
- 编辑权限：系统管理员、业务架构师
- 删除权限：仅系统管理员
- 导入导出权限：系统管理员

**数据权限**:
- 普通用户：仅能查看自己单位的系统
- 管理员：可查看所有系统
- 按组织架构过滤数据

### 11.2 操作审计

**审计内容**:
- 记录所有增删改操作
- 记录操作人、操作时间、操作IP
- 敏感操作（删除）需要二次确认
- 审计日志永久保存，不可删除

### 11.3 数据保护

**防护措施**:
- 删除操作软删除，数据可恢复
- 导入数据严格校验，防止注入
- 敏感字段加密存储（如联系方式）
- 定期备份数据库

---

## 12. 后续优化方向

### 12.1 用户体验

1. **快捷键支持**: 上下键切换节点，F2重命名
2. **批量操作**: 多选节点，批量修改属性
3. **模板管理**: 保存常用的系统信息模板
4. **对比功能**: 对比两个系统的差异

### 12.2 协作功能

1. **评论功能**: 在系统详情下添加评论
2. **@提醒**: 提及相关人员，发送通知
3. **变更通知**: 系统信息变更时通知相关人员
4. **协同编辑**: 多人同时编辑时的冲突处理

### 12.3 数据分析

1. **统计报表**: 各板块系统数量、技术栈分布
2. **健康度分析**: 文档完整性、更新频率分析
3. **趋势分析**: 系统数量变化趋势
4. **技术债务**: 识别老旧技术栈的系统

---

**文档版本**: v1.0
**最后更新**: 2025-10-15
**维护者**: Claude Code Assistant
