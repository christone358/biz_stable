# 安全工作台 | 产品设计说明文档（PRD）

面向读者：产品经理、研发工程师（前端/后端/测试）

文档目的：定义“安全工作台”作为一级菜单的首期能力——安全监测（覆盖应用安全、主机安全、网络安全），以“被保护对象”为中心（对象=应用系统/主机/网络域），替代纯告警列表视角，指导研发落地页面信息结构、关键展示与操作逻辑、LDM 映射与约束，并提供验收标准。

---

## 1. 业务说明（Scope）
- 目标：构建安全运营团队的对象中心化监测平台，让用户在“对象卡片 → 对象详情”的最短路径上完成态势判断与处置决策。
- 对象定义（Protected Object）：
  - 应用（Application）：一级/二级业务系统的运行体（含服务/集群归属）。
  - 主机（Host）：计算节点（与“云主机管理”一致，复用字段与展示规则）。
  - 网络（Network）：网络域/网段/边界（如核心区、办公网段、互联网边界）。
- 不在本期范围：告警规则配置中心、自动响应编排、报表与趋势、接口细节（本 PRD 不含 API 规范）。

名词约定
- 风险（Risk）：由“未处理告警数、关键高危漏洞/弱点、暴露面信号”综合映射的等级（正常/中/高）。
- 防护（Protection）：对象是否被有效防护（应用=WAF/漏洞防护；主机=EDR/基线；网络=IDS/IPS/ACL/分段）。
- 在线/可达（Online）：对象可观测的活跃状态（应用=健康探针/流量；主机=运行状态/心跳；网络=链路/探测）。

---

## 2. 信息架构（IA）与导航
- 一级菜单：安全工作台
  - 子菜单：安全监测（首期交付）
    - 视图切换（Segmented）：应用 | 主机 | 网络
    - 列表（对象卡片栅格）与详情（对象详情页）

导航与复用
- 主机视图的对象卡片与详情逻辑与“云主机管理”对齐，减少学习成本。
- 应用/网络的卡片与详情沿用“结论优先、可缺省隐藏”的模式。

---

## 3. 页面信息结构设计

### 3.1 列表页（对象中心卡片）
- 顶部统计 Token（自适应宽度，不铺满整行）：
  - 对象总览：总数 N + 右侧并列细分（在线/离线/未知）。
  - 风险态势：风险对象总数 R（=高+中） + 右侧并列（高/中/正常）。
  - 防护覆盖：覆盖率 P% + 右侧“未纳入防护 M”。
  - 右上角操作：新建对象/导入/导出（按当前视图的对象类型变化，页面仅此一处）。
- 标题行右上角工具区：
  - 一键式搜索框：按名称/标识/责任人/标签/业务系统。
  - 快捷筛选（AntD Tag.CheckableTag，互斥单选，可清空）：
    - 风险：正常 / 中 / 高
    - 在线状态：在线 / 离线 / 未知（“应用=健康；主机=运行；网络=可达/连通”）
    - 防护状态：防护中 / 离线 / 未纳管
  - 扩展筛选（Popover Drawer，可选）：业务板块（一级）、业务系统（二级，可检索）、责任人、标签、时间范围（最近 24h/7d/30d）。
- 卡片栅格：6 列、gap 16、min-height 160；标签行贴底；缺数据不占位。
- 卡片信息结构（通用骨架，按对象类型渲染差异化字段）：
  - 头部：对象名称（单行省略） · 主标识（应用域名/服务名；主机IP；网络网段）
  - 次信息行：来源/归属（应用=业务系统；主机=云平台/规格；网络=区域/边界类型）
  - 右上角结论栈（横向紧凑）：
    - 风险进度格（3格：红/黄/绿）
    - 防护图标（仅图标，hover 显示“应用WAF/主机EDR/网络IDS 状态”）
    - 在线色点（绿/灰/橙）
  - 标签行：业务系统（二级系统）必显，其他标签可选；超长省略。

对象类型的要点
- 应用卡片：
  - 主标识：主入口域名或服务名 · 环境（prod/staging 可选）
  - 次信息：所属一级/二级系统 · 运行集群/服务数（可选）
  - 防护图标：WAF/漏洞防护/加固（具备其一则显示“防护中”，缺失则“未纳管/离线”）
- 主机卡片：复用云主机卡片规范（名称、IP、运行色点、风险格、EDR 图标、来源与规格）。
- 网络卡片：
  - 主标识：网段/边界名称（如 “办公网段 10.10.0.0/16”/“互联网出口-东”）
  - 次信息：区域/用途（核心/办公/DMZ） · 设备数量/连接数（可选）
  - 防护图标：IDS/IPS/ACL 分段有效性（有其一生效即记“防护中”）

交互规则
- 缺失实时状态（风险/防护/在线）时隐藏对应图元，卡片高度保持一致。
- 点击卡片进入详情；卡片整体可点击，支持键盘 Enter。

### 3.2 详情页（对象详情）
结论优先的两列布局：顶部“结论条” + 左“静态信息” / 右“安全态势”。

通用结论条（横向）：
- 基本身份：名称 · 主标识（域名/IP/网段）
- 在线：色点（绿/灰/橙） + 最近可达/心跳时间（有则显示）
- 风险：三格进度（hover 显示“高危漏洞/未处理告警/暴露信号”组成）
- 防护：图标（应用=WAF/主机=EDR/网络=IDS 之一或组合，hover 说明）

左侧：静态信息（分组卡片）
- 应用：基本信息（名称/系统/负责人/环境）、部署（集群/服务/主机数）、入口（域名/端口/协议）
- 主机：复用云主机“基础/硬件与OS/组织与业务/网络与位置”
- 网络：基本信息（名称/CIDR/区域/用途）、边界/设备（关联系统/出口/设备清单可选）

右侧：安全态势（分组卡片）
- 监测与防护：
  - 应用：WAF/漏洞防护/加固状态、近 24h QPS、拦截/绕过指标
  - 主机：EDR 在线/心跳、基线状态（可选）
  - 网络：IDS/IPS 告警启用、ACL/分段有效性
- 风险概览：未处理告警数（按高/中/低）、高危漏洞数、弱点/暴露点（如端口暴露）
- 最近事件：近 7~30 天关键事件时间线（安全/运维），无则空态
- 关联对象与拓扑（可选）：
  - 应用 → 主机（部署拓扑/关联主机列表）
  - 网络 → 设备/主机（所在网段对象）

---

## 4. 关键展示与业务逻辑

风险分级（通用映射）
- 高：高危漏洞数 > 0 或 未处理高危告警 ≥ 1 或 未处理告警总数 ≥ 3。
- 中：未处理告警 ∈ [1,2] 且高危漏洞数 = 0。
- 正常：其余。

防护判定
- 应用：
  - 防护中：WAF 或 漏洞防护（RASP/自研）启用且在线
  - 离线：配置存在但近 30 分钟无心跳/无流量
  - 未纳管：无任何防护能力接入
- 主机：与云主机 PRD 一致（EDR 未安装/离线/防护中）。
- 网络：
  - 防护中：IDS/IPS/ACL/微分段 任一启用且有效
  - 离线：设备存在但监测探针无数据
  - 未纳管：未接入任何监测/防护

在线/可达
- 应用：健康探针通过 或 近 5 分钟有成功请求
- 主机：status=RUNNING/STOPPED/UNKNOWN（复用）
- 网络：目标网段/边界近 5 分钟探测或流量可达

统计口径
- 顶部统计 Token 与列表卡片来源一致；按当前筛选集实时计算。
- 覆盖率 = 已纳入防护对象数 / 对象总数。

隐藏规则与说明
- 缺失数据的图元不展示（不显示“未知”的标签/图标），但可在 hover 中提示“暂无数据”。
- 所有“最近时间”型字段均以“相对时间展示 + title 显示绝对时间”。

---

## 5. LDM（逻辑数据模型）与字段映射

5.1 通用字段（对象基类）
- id: string（对象ID）
- objectType: 'APPLICATION' | 'HOST' | 'NETWORK'
- name: string（对象名称）
- primaryIdentifier: string（域名/主IP/CIDR）
- businessBlock: string（一级系统）
- businessSystem: string（二级系统，卡片标签必显）
- owner: string（责任人/Owner）
- tags?: string[]

5.2 安全态势字段（共用）
- pendingAlerts: { total: number; high: number; medium: number; low: number }
- vulnerabilities: { critical: number; high: number; medium: number; total: number }
- protection: { installed: boolean; online: boolean; kind: 'EDR' | 'WAF' | 'IDS' | 'IPS' | 'ACL' | 'HARDENING' | 'NONE' }
- onlineStatus: 'ONLINE' | 'OFFLINE' | 'UNKNOWN'
- lastSeenAt?: string (ISO)

5.3 应用特有
- domainOrService: string
- environment?: 'prod' | 'staging' | 'dev'
- clusterCount?: number
- instanceCount?: number
- wafEnabled?: boolean

5.4 主机特有（复用 cloud-hosts-prd）
- hostName, ipAddress, cpu, memory, disk, vendor/dataSource.provider, edrInstalled, edrOnline, status 等

5.5 网络特有
- cidr: string（如 10.10.0.0/16）
- zone: string（核心/办公/DMZ/互联网边界）
- deviceCount?: number
- aclEnabled?: boolean
- idsEnabled?: boolean
- ipsEnabled?: boolean

映射到 UI
- 风险进度格：high/medium/ok → 1红/2黄/3绿（ok=其余）。
- 防护图标：protection.kind + installed/online → 图标 + hover 说明。
- 在线色点：onlineStatus → 绿/灰/橙。

---

## 6. 输入/输出与约束

输入（UI）
- 搜索：自由文本（匹配 name/primaryIdentifier/owner/businessSystem/tags）。
- 筛选：风险/在线/防护（互斥单选，可清空）；业务板块/业务系统（下拉可检索，多选）；时间范围。
- 视图切换：应用/主机/网络（影响卡片字段、统计与操作文案）。

输出（UI）
- 顶部统计 Token：总数/在线细分/风险细分/覆盖率与未纳管。
- 卡片栅格：6 列；对象卡片点击达详情；hover 显示图标解释。
- 详情：结论条 + 左静态/右安全；最近事件时间线。

约束与边界
- 遵循 UI 规范与 8px 栅格；CheckableTag 未选中态需具备浅底+描边。
- 缺失字段不占位；长文本省略并提供 title。
- 首期不引入重型拓扑绘制，关联对象以列表/简图为主。

---

## 7. 验收标准（DoD）
- 安全监测页：
  - 顶部三项 Token 紧凑排列、数据口径正确；右上角仅一组“新建/导入/导出”。
  - 搜索与三组快捷筛选（风险/在线/防护）同行展示，不换行；未选中态可读性良好。
  - 视图切换（应用/主机/网络）可用；卡片 6 列、信息结构符合对象类型规范；缺数据图元隐藏。
- 详情页：
  - 通用结论条展示在线色点、风险进度格、防护图标；hover 说明齐全；最近时间为相对时间。
  - 左静态/右安全信息分组展示；“最近事件”无数据显示空态。

---

## 8. 线框图（ASCII）

列表页（以“应用”视图示例）

```
[ 安全监测 | 视图: 应用 | 主机 | 网络 ]         [ 新建 ][ 导入 ][ 导出 ]

(Token) 总数 128   (在线 96 / 离线 20 / 未知 12)    (Token) 风险 对象 34  [高 5 | 中 29 | 正常 94]
(Token) 防护覆盖 78%   [未纳管 28]

[ 搜索框: 名称/域名/责任人/标签 ]  风险: [ 正常 ][ 中 ][ 高 ]  在线: [ 在线 ][ 离线 ][ 未知 ]  防护: [ 防护中 ][ 离线 ][ 未纳管 ]

┌────────────────────┐  ┌────────────────────┐  ┌────────────────────┐
│ 应用A                │  │ 应用B                │  │ 应用C                │
│ www.app-a.com        │  │ api.app-b.com        │  │ svc.app-c            │
│ 一二级系统 · prod     │  │ 二级系统 · staging    │  │ 二级系统 · prod       │
│ [■□□]  🛡  ●          │  │ [■■□]  ⛔  ○          │  │ [■■■]      ○          │
│ 标签：系统B/支付       │  │ 标签：系统C           │  │ 标签：系统D           │
└────────────────────┘  └────────────────────┘  └────────────────────┘
```

详情页（通用）

```
名称 · 主标识                 ● 在线   [风险进度格 ■■□]   🛡 防护中（hover）   最近可达 3 分钟前

左：静态信息                                  右：安全态势
- 基本信息/归属/…                              - 监测与防护（WAF/EDR/IDS）
- 部署/网络/…                                  - 风险概览（告警/漏洞/暴露）
                                               - 最近事件时间线（7~30天）
```

---

## 9. 联动与后续规划（非功能性，供研发参考）
- 复用与依赖：
  - 主机视图直接复用云主机卡片与详情实现（字段命名与 LDM 一致）。
  - 搜索/筛选组件沿用云主机的实现样式与模式（CheckableTag + 一键式搜索）。
- 目录建议（实现期）：
  - `src/pages/security-workbench/monitoring/List.tsx`、`Detail.tsx`、`List.module.less`
  - `src/types/security-object.ts`（对象基类 + 应用/网络扩展）
  - `src/mock/security-objects.ts`（演示数据）

本 PRD 不包含接口细节、实施计划与对外依赖清单。

---

## 10. 应用安全视图细化（关键指标与聚合口径）

目标：以“业务应用（= 一级系统/二级系统）”为观察单元，覆盖“应用访问行为、业务操作风险、外部攻击行为”的分析与威胁识别；实现多维度查询与告警研判支撑。所有指标按时间窗口计算（默认近 24 小时，可切换 1h/6h/7d/30d）。

### 10.1 关键指标（Cards/Token + 趋势）
- 访问行为
  - 请求量(QPS/请求数)：总请求数、峰值 QPS、同比/环比（同窗对比）
  - 异常比例：4xx/5xx 占比、错误峰值时间
  - 访问分布：唯一来源 IP/账号/UA/地理/ASN 分布（Top5）
  - 基线偏差：相对历史基线的偏差分（z-score 或百分位偏离），用于提示异常流量波动
- 业务操作风险（依赖“业务操作字典”，标注敏感动作）
  - 敏感操作计数：新增管理员/授权变更/导出数据/批删等
  - 异常画像：非常用时间段/非常用地点/非常用设备执行敏感操作次数
  - 账号异常：高风险账号触发敏感操作的次数（或占比）
- 外部攻击行为（WAF/日志/IDS 汇聚）
  - 攻击尝试：SQLi/XSS/RCE/目录穿越/暴力破解/扫描等分类计数（Top-N）
  - 拦截成效：被拦截占比（Blocked/All），异常放行数（Bypass/Pass）
  - 攻击源画像：Top 源 IP/ASN/国家/工具指纹

说明：指标默认以“二级系统”为基本单位，若仅有“一级系统”则直接聚合到一级；同一系统下的多主机/多服务按并集聚合。

### 10.2 风险量化与分类（对象级结论）
- 应用风险等级（High/Medium/OK）：
  - 高：高危漏洞>0 或 高危告警≥1 或 异常放行≥1；
  - 中：未处理告警∈[1,2] 且高危漏洞=0 且异常放行=0；
  - 正常：其余。
- 应用风险指数 AppRiskIndex（0~100）：
  - 组成：攻击强度(40%) + 异常操作(35%) + 基线偏差(15%) + 异常错误率(10%)
  - 归一化：各子项在时间窗口内 min-max 或百分位归一，失量按权重加总；
  - 用途：用于系统列表排序与阈值告警；阈值默认 ≥70 高、[40,70) 中、<40 正常。
- 在线/可达：5分钟内有成功请求 或 健康探针通过；否则离线（无数据为未知）。
- 防护状态（应用）：WAF 或 漏洞防护启用且在线=防护中；有配置无心跳=离线；未接入=未纳管。

### 10.3 聚合与口径（系统视角）
- 聚合边界：按业务系统（businessBlock/一级、businessSystem/二级）聚合对象与事件；
  - 资产归属：系统→服务/主机 映射表（可由 CMDB/标签提供）；
  - 事件归属：按请求目标域名/服务ID/主机归属映射到系统；
- 去重与汇聚：
  - 告警去重：相同系统+相同规则+近 X 分钟内来自同源（IP/UA/账号）的重复告警合并为一组；
  - 事件归并：同一攻击会话的多个阶段（探测→利用→放行）按 sessionId/时间邻近合并；
  - 视图展示：组级计数 + 代表事件；明细可展开。

### 10.4 多维度查询（告警与事件）
- 维度：
  - 时间：最近 1h/6h/24h/7d/30d，自定义时间
  - 业务：一级/二级系统（可检索，多选）
  - 严重性：高/中/低；告警状态：新建/研判中/已确认/已处置/误报/抑制
  - 分类：访问异常/业务操作/攻击类型（SQLi/XSS/RCE/BruteForce/Scanner/...）
  - 技术映射：MITRE ATT&CK（战术/技术）
  - 来源画像：来源 IP/ASN/国家/UA/账号/角色
  - 目标：域名/接口/方法/主机/服务
- 结果：
  - 支持“按系统聚合”与“按事件明细”切换；
  - 导出当前查询结果（CSV/JSON）。

### 10.5 告警研判（工具与流程）
- 流程状态：新建 → 研判中 → 已确认（事件）/误报 → 处置中 → 已处置 → 关闭/抑制
- 研判工具：
  - 证据面板：原始日志、WAF 规则命中、请求上下文（URL/参数/UA/Cookie/Referer/源IP/ASN/地理）
  - 画像联想：同源攻击、同目标攻击、同账号敏感操作链路
  - 知识映射：MITRE/规则说明/修复建议；关联“云主机/网络”上下文
  - 动作：指派责任人/部门、添加备注标签、创建任务（联动任务中心）、一键抑制（规则/源）
- SLA 与通知：按严重性设定研判 SLA 与升级策略（通知渠道本期不实现，PRD 不含接口）。

### 10.6 UI 结构（列表与详情）
- 列表（应用视图）：
  - 顶部 Token：对象总览 / 风险态势 / 防护覆盖（按 10.1 口径）；
  - 搜索 + 筛选：系统、严重性、分类、状态；
  - 卡片：名称、主域名/服务、系统归属、右上角“风险进度格 + 防护图标 + 在线色点”、标签（二级系统必显），以及次行的关键指标摘要（如“拦截 1.2k | 放行 3 | 敏感操作 12 | 错误率 2.3%”）。
- 详情（应用）：
  - 结论条：在线/风险/防护 + 最近可达时间；
  - 左：静态与部署信息（系统/负责人/环境/入口/服务与主机清单）；
  - 右：
    1) 关键指标趋势（近 24h 请求、错误、拦截/放行、敏感操作）；
    2) 风险概览（攻击分类 Top、异常操作 Top、同源画像）；
    3) 告警与事件清单（支持 10.4 的筛选子集）；
    4) 关联主机与网络上下文（列表链接至对应视图）。

### 10.7 数据模型补充（应用视图）
- 应用对象扩展字段：
  - metrics.requestCount, metrics.peakQps, metrics.error4xxRate, metrics.error5xxRate
  - metrics.uniqueIp, metrics.uniqueAccount, metrics.uniqueUa, metrics.topCountries[], metrics.topAsn[]
  - metrics.baselineDeviationScore (0~100)
  - metrics.sensitiveOps: { total, byType: Record<string, number>, abnormalContextCount }
  - attacks: { byType: Record<'SQLI'|'XSS'|'RCE'|'DIR_TRAV'|'BRUTE'|'SCAN'|string, number>, blocked: number, bypass: number, sourcesTop: string[] }
  - appRiskIndex: number (0~100)
  - onlineStatus: 'ONLINE'|'OFFLINE'|'UNKNOWN', lastSeenAt?: string
  - protection: { kind: 'WAF'|'RASP'|'HARDENING'|'NONE', installed: boolean, online: boolean }
- 映射关系：
  - 列表 Token 与卡片摘要取自 metrics/attacks 聚合；
  - 风险进度格与 appRiskIndex/告警口径映射一致；
  - 防护图标由 protection 映射，并在 hover 呈现详情。

### 10.8 验收补充（DoD）
- 应用视图展示：
  - Token 指标与卡片摘要口径一致；
  - 关键指标可按时间窗口切换；
  - 多维度查询可按系统聚合与事件明细切换；
  - 研判流程具备状态流转、证据面板、指派与备注能力（UI 流程就绪）。
