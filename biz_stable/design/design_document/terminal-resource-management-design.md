# 终端资产管理模块 

## 📋 用户反馈处理说明

本文档基于以下用户反馈对原始设计进行了调整：

### 反馈1：菜单位置调整
**原设计**: 终端资产管理作为一级菜单（独立展示）
**调整后**: 终端资产管理作为**业务资产管理**的二级菜单
**理由**: 与现有"业务板块管理"和"资产管理"保持一致，形成完整的资产管理体系

### 反馈2：统计分析整合
**原设计**: 云主机、办公终端各有单独的统计分析页面
**调整后**:
- 云主机统计分析 + 办公终端统计分析 **合并为一个页面**
- **可进一步考虑** 纳入业务板块的统计分析，形成**统一的资产统计分析中心**

### 反馈3：资产运营功能重复确认
**原设计**: 终端资产管理中包含"资产运营"模块
**分析结果**:
- **已实现的资产运营** (`/management/asset-operations`): 处理**异常资产**（无主、未知、不合规），通过协同工单形式推送给责任单位处理
- **拟实现的资产运营**:
  - **取消独立的"资产运营"管理界面**
  - **导入导出功能** 集成到云主机列表和终端列表中（资产台账信息维护的基础功能）
  - **台账核查和变更记录** 功能调整
- **结论**: 异常资产发现后通过协同工单推送，而非在单独的管理界面处理

### 反馈4：数据模型验证
**Excel文件分析**:
- **云主机sheet**: 14列字段
- **终端sheet**: 54列字段（从企业EDR系统导出）
- **已根据实际字段调整数据模型** 见第3章节

### 业务关联字段调整
**术语对应关系**:
- Excel中的"一级系统" → 系统中的"业务板块"（对应业务资产领域）
- Excel中的"二级系统" → 系统中的"业务系统"（对应业务资产领域）
- Excel中的"一级系统负责人" → 系统中的"业务系统负责人"

---

## 🗂️ 功能架构

### 菜单结构（NEW）

```
业务保障管理系统
├── 业务全景
│   ├── 业务健康概览
│   └── 业务运行监测
├── 业务资产管理              ← 一级菜单
│   ├── 业务板块管理
│   ├── 资产管理
│   ├── 终端资产管理          ← 新增二级菜单
│   │   ├── 云主机管理
│   │   ├── 办公终端管理
│   │   └── 资产集成配置
│   └── 资产统计分析          ← NEW，独立二级菜单
├── 业务保障管理
│   ├── 资产告警监测
│   ├── 资产运营              ← 已实现（异常资产处理，通过协同工单推送）
│   └── 脆弱性管理
└── 协同工作中心
    ├── 协同任务管理
    └── 任务执行记录
```

### 核心功能模块（调整）

| 模块 | 二级菜单 | 功能描述 | 状态 |
|-----|---------|---------|------|
| **云主机管理** | - | 云主机资产台账、运行状态、安全防护、导入导出 | 新开发 |
| **办公终端管理** | - | 办公终端资产台账、在线状态、EDR防护、导入导出 | 新开发 |
| **资产集成配置** | - | 云管平台、EDR系统对接，自动同步 | 新开发 |
| **资产统计分析** | *二级菜单* | **统一的资产统计分析中心，作为业务资产管理二级菜单** | 新开发 |

---

## 📊 调整后的数据模型

基于 Excel 样例 `docs/asset-info-sample.xlsx` 中的“云主机”“终端”两个 sheet，调整了数据模型设计，确保字段与交付台账一一对应；随后页面层面的搜索、KPI、表格字段均以该模板约束为准。

### 云主机资产数据模型（调整版）

根据Excel云主机sheet的14列，以下是映射的数据模型；其中“一级系统/二级系统”**完全等同于项目中既有的业务板块（BusinessBlock）与业务系统（BusinessSystem）概念**，并需要额外建立到业务版本、业务资产的引用，确保资产视角与业务管理模块一致：

```typescript
interface CloudHost {
  // 基本信息（对应Excel）
  id: string                          // 系统生成ID
  hostName: string                    // 云主机名称 ✓
  label?: string                      // 标签
  ipAddress: string                   // IP ✓

  // 运行状态（对应Excel）
  status: 'RUNNING' | 'STOPPED' | 'UNKNOWN'  // 状态 ✓
  protectionStatus: 'PROTECTED' | 'UNPROTECTED' | 'UNASSIGNED'  // 防护状态（结合云管或安全中心）

  // 硬件规格（对应Excel）
  cpu: number                         // CPU (C) ✓
  memory: number                      // 内存 (GB) ✓
  disk: number                        // 磁盘 (GB) ✓
  osType: string                      // 操作系统 ✓
  osVersion?: string

  // 资产分类（对应Excel）
  type: 'STANDARD' | 'TRUSTED_CREATION'  // 类型（信创等）✓

  // 组织关联（对应Excel）
  department: string                  // 部门 ✓

  // 业务关联（对应Excel - 调整为业务资产领域术语）
  businessBlock: string               // 业务板块名称 ✓ (对应Excel的"一级系统")
  businessSystem: string              // 业务系统名称 ✓ (对应Excel的"二级系统")
  businessBlockId: string             // 业务板块ID（引用业务板块管理模块）
  businessSystemId: string            // 业务系统ID（引用业务资产管理模块）
  businessAssetId?: string            // 业务资产ID（引用资产管理中的具体资产）
  businessVersionId?: string          // 业务版本ID（引用业务版本/迭代信息）

  // 责任信息（对应Excel）
  requester?: string                  // 申请人
  systemOwner: string                 // 业务系统负责人 ✓ (对应Excel的"一级系统负责人")

  // 数据来源和同步
  dataSource: {
    source: 'CLOUD_PLATFORM' | 'MANUAL'
    lastSyncTime: string
    syncStatus: 'SUCCESS' | 'FAILED' | 'PENDING'
    lastModifyTime: string
    lastModifyUser: string
  }

  // 扩展字段（可选）
  remarks?: string
  tags?: string[]
}
```

### 办公终端资产数据模型（调整版）

根据Excel终端sheet的54列，核心字段映射如下：

```typescript
interface OfficeTerminal {
  // 基本信息（对应Excel）
  id: string                          // 系统生成ID
  serialNumber: number                // 序号 ✓
  ipAddress: string                   // IP ✓
  macAddress: string                  // MAC ✓
  deviceName?: string                 // 设备名称 ✓

  // 业务关联（与云主机保持一致）
  businessBlock: string               // 业务板块名称
  businessSystem: string              // 业务系统名称
  businessBlockId: string             // 业务板块ID（BusinessBlock）
  businessSystemId: string            // 业务系统ID（BusinessSystem）
  businessAssetId?: string            // 绑定的业务资产ID（资产管理模块）
  businessVersionId?: string          // 业务版本ID

  // 组织关联（对应Excel）
  organization: string                // 组织机构 ✓ (闵行区/区政府/...)
  department?: string                 // 部门名称 ✓
  office?: string                     // 科室名称 ✓
  unitName?: string                   // 单位名称 ✓

  // 使用者信息（对应Excel）
  ownerName?: string                  // 姓名 ✓
  loginAccount?: string               // 登录账号 ✓

  // 设备状态（对应Excel）
  powerStatus: 'ON' | 'OFF' | 'UNKNOWN'  // 开机状态 ✓
  lastActiveTime?: string             // 最后活跃日期 ✓

  // 安全防护状态（对应Excel）
  agentInstallStatus: 'YES' | 'NO'   // 安装状态 ✓（EDR/安全代理）
  blockingStatus: 'BLOCKED' | 'UNBLOCKED'  // 安全管控状态 ✓
  blockingTime?: string               // 被安全管控时间 ✓
  lockStatus: 'LOCKED' | 'UNLOCKED'  // 锁定状态 ✓
  protectionStatus: 'PROTECTED' | 'UNPROTECTED'  // 保护状态 ✓

  // 安全合规（对应Excel）
  agentType?: string                  // 客户端类型 ✓
  agentVersion?: string               // 客户端版本号 ✓
  auditStatus?: string                // 注册审核状态 ✓
  antivirus?: string                  // 杀毒软件 ✓
  antivirusName?: string              // 杀毒软件名称 ✓
  antivirusBrand?: string             // 杀毒软件品牌 ✓
  antivirusVersion?: string           // 杀毒软件版本 ✓

  // 硬件配置（对应Excel）
  cpuModel?: string                   // CPU型号 ✓
  cpuFrequency?: string               // CPU主频 ✓
  diskSize?: number                   // 硬盘大小(G) ✓
  memorySize?: number                 // 内存大小(G) ✓
  hardDiskId?: string                 // 硬盘号 ✓
  deviceSN?: string                   // 设备SN号 ✓

  // 操作系统（对应Excel）
  osType: string                      // 操作系统 ✓
  osVersion?: string                  // 操作系统版本 ✓
  osDescription?: string              // 操作系统描述 ✓
  osLanguage?: string                 // 操作系统语言 ✓
  osInstallTime?: string              // 操作系统安装时间 ✓
  osSerialNumber?: string             // 操作系统序列号 ✓
  isMultiOS?: boolean                 // 是否是多操作系统 ✓

  // 设备位置和分类（对应Excel）
  location?: string                   // 计算机所在地 ✓
  switchIP?: string                   // 交换机Ip ✓
  deviceType?: string                 // 设备类型 ✓
  computerType?: string               // 计算机类型 ✓
  assetNumber?: string                // 资产号 ✓
  assetCategory?: string              // 资产分类 ✓
  deviceDescription?: string          // 设备描述 ✓
  computerUsage?: string              // 计算机用途 ✓

  // 时间信息（对应Excel）
  registrationTime?: string           // 注册时间/发现时间 ✓
  uninstallTime?: string              // 卸载时间 ✓

  // 其他（对应Excel）
  deviceID?: string                   // 设备ID ✓
  healthScore?: number                // 健康体检分数 ✓
  dataSource?: string                 // 信息来源 ✓

  // 系统字段
  dataSourceType: {
    source: 'EDR' | 'LDAP' | 'MANUAL' | 'MIXED'
    lastSyncTime: string
    syncStatus: 'SUCCESS' | 'FAILED' | 'PENDING'
    lastModifyTime: string
    lastModifyUser: string
  }
}
```

### 数据模型验证结果

| 来源 | 字段数 | 覆盖程度 | 备注 |
|-----|-------|--------|------|
| Excel云主机 | 14 | 100% | 所有字段已映射，业务关联字段已调整为业务板块/业务系统 |
| Excel终端 | 54 | 100% | 所有字段已映射，包括EDR特有字段 |
| 扩展字段 | +5 | 补充 | 系统生成的扩展字段 |

> **关联说明**：以上两个模型都携带 `businessBlockId/businessSystemId/businessAssetId/businessVersionId`，分别与“业务板块管理”“资产管理”“业务版本管理”模块中的实体保持一对一/多对一关联，确保任一主机或终端都能追溯到其业务资产与版本。
> `protectionStatus` 字段来源于云管平台或安全中心的兜底数据（若 Excel 未提供则默认 `UNASSIGNED`），用于在列表中展示“防护状态”。

---

## 🎨 调整后的页面设计

### 核心页面清单（调整）

> **设计理念（云主机）**：详情页围绕“静态基础信息 → 业务关联 → 安全状态”三层展开。
> 1) **基础信息**反映主机本身的属性（名称、IP、型号、操作系统等），由集成同步或人工维护；
> 2) **业务关联信息**说明主机在业务版图中的位置（所属业务板块/系统/资产、责任人、联系人），体现“以业务为视角”的资产管理目标；
> 3) **安全资产信息**聚焦防护状态（EDR安装运行、病毒库版本）、安全态（安全管控、准入、告警/脆弱性数量），用来支撑业务保障与安全运营的一体化展示。

#### 第1层：仪表板首页
- **页面名称**: 终端资产管理概览
- **内容**: KPI、健康分布、风险汇总、最近告警

#### 第2层：云主机管理
- **云主机列表** (14列配置，包含导入导出功能)
- **云主机详情** (基本信息、运行、规格、业务关联、安全、责任)
  - 业务关联：关联到业务板块和业务系统
  - 导入导出：支持Excel格式的批量导入导出，用于数据初始化和更新
- **过滤/搜索区**：一级下拉（业务板块 → 系统 → 资产）、运行状态 Tag、防护状态 Tag、同步来源、部门多选；核心搜索框新增“基础字段设置”开关，可配置搜索范围（主机名称/IP/责任人/资产名称/标签）。
- **KPI 区**：延续纳管量 / 在线率 / 异常主机，同时新增“安全覆盖率（EDR安装&在线）”和“安全管控主机”卡片，卡片可点击下钻列表。
- *统计分析页面已整合到后续的统一分析页*

##### 线框图（云主机管理列表 + 详情）

```
+--------------------------------------------------------------------------------------------------+
| 业务资产管理 / 终端资产管理 / 云主机管理        [导入台账] [导出台账] [新建云主机]               |
+--------------------------------------------------------------------------------------------------+
| 业务板块[∨]  业务系统[∨]  业务资产[∨]  状态[运行/停止/未知]  防护[已防护/未防护]  同步来源[∨]     |
| 部门[多选]  基础字段设置[⚙ 名称/IP/责任人/资产/标签]  快捷筛选:[未受防护] [最近同步失败] [仅运行中] |
| 关键字 [_____________________________]                                  [查询] [重置条件]         |
+--------------------------------------------------------------------------------------------------+
| KPI: ① 纳管云主机 ② 在线率 ③ 异常主机 ④ 安全覆盖率(EDR安装&在线) ⑤ 安全管控主机               |
+--------------------------------------------------------------------------------------------------+
| 工具: [列设置] [批量操作▼] [刷新] 实时刷新 ON [15s▼]                                            |
|--------------------------------------------------------------------------------------------------|
| □ | 主机名称   | IP地址     | 运行状态 | 防护状态 | 关联业务资产(板块/系统/资产) | 部门  | 责任人 | … |
|----+-----------+------------+----------+----------+------------------------------+-------+--------+----|
| □ | host-001   | 10.10.1.11 | ●运行    | 盾受保护 | 一梁/支付系统/支付核心       | 技术部| 张伟   |    |
|    | 操作: 查看详情 / 编辑 / 导出 / 移除                                                               |
|----+-----------+------------+----------+----------+------------------------------+-------+--------+----|
| 分页 1 2 3 ...  [上一页][下一页]  每页 20 ▼                                                      |
+--------------------------------------------------------------------------------------------------+

云主机详情（独立页面，顶部摘要 + 三列关键信息）
--------------------------------------------------------------------------------------------------
面包屑 + 操作：返回列表 / 导出 / 同步 / 编辑（保持全屏展示，一屏覆盖基础信息+业务关联+安全状态）
--------------------------------------------------------------------------------------------------

顶部告警条（按需展示）：[已安全管控 RED: 原因/时间] [EDR 未安装/未运行 ORANGE] [病毒库过期 ORANGE]

┌────────── Hero 摘要（左：基础信息 / 右：安全指标卡） ────────────────────────────────┐
│ 左侧：主机名、业务关联（板块/系统/资产）、IP、规格、OS、数据来源 + 运行/准入/EDR Tag                │
│ 右侧：4 张 KPI mini card → 未处理告警数 / 脆弱性数 / 安全管控状态 / 安全防护状态（颜色随风险等级）          │
└────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────── 静态参数（型号/品牌/参数） ─────────┐  ┌────────────── 安全防护与状态（详细） ────────────┐  ┌────────────── 业务使用情况（当前） ─────────────┐
│ [基础属性] 主机名/标签/ID  类型(信创/标准)              │  │ [EDR代理] 安装状态/版本/在线  病毒库版本                 │  │ [业务关联] 业务板块/系统/资产                           │
│ [网络] 管理IP/业务IP(Multi)/MAC(可选)                  │  │ [安全策略] 防护策略  基线/补丁(预留)                    │  │ [业务版本] 版本号/状态/发布时间                         │
│ [规格参数] CPU/内存/磁盘                               │  │ [安全管控] 管控状态  准入状态                          │  │ [责任主体] 责任单位/部门/责任人/联系方式                │
│ [操作系统] OS类型/版本                                 │  │ [风险摘要] 告警/脆弱性统计（取自 mini card 数据源）     │  │ [申请记录] 申请人/时间                                   │
│ [位置/区域] 区域/可用区(可选)                          │  │ [快捷入口] 查看同步日志｜查看操作记录（按钮形式）        │  │ [跳转] 查看业务资产/系统详情(链接)                      │
└────────────────────────────────────────────────────────┘  └──────────────────────────────────────────────────────────┘  └────────────────────────────────────────────────────────┘

> **已移除** “运行与规格（折叠）”“变更轨迹”卡片，相关日志 / 运行指标通过安全卡片底部按钮进入独立侧栏或监控页面，防止干扰核心业务信息。
--------------------------------------------------------------------------------------------------

**办公终端详情** (基本信息、运行、硬件、系统、安全、位置、分类)
- **导入导出** (支持Excel格式的批量导入导出，用于数据初始化和更新)
- *统计分析页面已整合到后续的统一分析页*

#### 第4层：资产集成配置
- **配置管理** (云管平台、EDR、LDAP对接)
- **同步监控** (实时进度、数据统计)
- **同步日志** (详细记录)

#### 第二级菜单：资产统计分析（已独立）
- **云主机统计分析**
  - 分布分析（按状态、类型、部门分布）
  - 健康分布（健康/异常比例）
  - 风险分析（告警数、脆弱性数）
  - 资产趋势（新增、下线、异常激增）

- **办公终端统计分析**
  - 分布分析（按类型、状态、部门分布）
  - 在线率（在线/离线/隔离统计）
  - EDR覆盖率（已安装/未安装）
  - 风险分析（告警、脆弱性、安全管控设备）
  - 资产趋势

- **（可选扩展）业务资产统计**
  - 与业务板块、资产管理的统计数据联动
  - 形成完整的资产生态展示（该页与终端资产管理并列，位于业务资产管理的二级菜单）

---

## 🧱 终端字段显示方案（已定稿）

### 列表字段策略

- **云主机列表**
- 默认列（对齐 `docs/asset-info-sample.xlsx` → `云主机` sheet 的核心字段，并补充防护及业务引用）：主机名称、IP地址、运行状态、**防护状态**、关联业务资产（展示“业务板块 / 业务系统 / 资产名称”合并信息）、所属部门、系统负责人、规格（以“4C/16G/200G”展示CPU/内存/磁盘）、类型（信创/标准）、同步来源、同步状态、最后同步时间。
- 可选列：标签、操作系统类型/版本、申请人。通过列设置弹窗开启，面向台账运营。
- 业务版本信息不在列表展示，统一在详情页体现（若需要按版本筛选，可在“基础字段设置”里开启该搜索字段），降低列宽压力。
- 行操作：查看详情、编辑、导出该行、移除/批量操作；状态列带颜色点（绿=RUNNING、灰=STOPPED、黄=UNKNOWN）。

**办公终端列表**
- 默认列（12列）：设备名称、IP、MAC、所属组织（含部门/科室级联）、使用人、登录账号、开机状态、最后活跃时间、EDR安装状态、安全管控状态、保护状态、所在地/交换机IP。
- 可选列：CPU型号、内存/硬盘、操作系统、客户端版本、资产分类、设备SN、健康分、数据来源等，其余字段按“设备信息 / 系统信息 / 安全信息 / 资产信息”四组折叠在列设置里。
- 行操作：详情、隔离/解除、导出单行。安全管控状态、保护状态使用Antd `Tag` 显示（红=已管控、绿=保护中、灰=未安装）。

### 详情页面结构

**云主机详情**（独立完整页面 `/management/terminal-assets/cloud-hosts/:id`，无顶层Tabs）：顶部面包屑+操作按钮（编辑、导出、返回列表）。首屏包含“资产概述”（基本描述+关键状态），其下采用三栏布局（左：静态参数｜中：安全防护与状态｜右：业务使用情况）；窄屏自动折叠为单列。同步/操作日志以小入口打开侧边 Drawer，避免干扰核心信息。
1. **基础信息（静态属性）**：主机名、IP、运行状态、规格（CPU/内存/磁盘）、操作系统、虚拟化/型号、所属区域、同步来源与时间。
2. **业务与安全摘要（首屏）**：一级系统 / 二级系统、部门与责任人/联系方式、申请人；EDR安装/在线、病毒库版本、安全管控/准入、未处理告警与脆弱性数量（Chip 展示）。
3. **业务与责任（详情）**：业务版本（状态/发布时间）、责任单位、更多联系人，支持跳转到业务板块/资产管理界面。
4. **安全与资产保障（详情）**：类型（信创或标准）、防护策略、客户端版本、最近安全事件列表；同步时间轴与导入日志小入口（打开侧边 Drawer）。

**左列分组规则（主机身份带）**
- 采用单卡片承载“基础信息 + 规格 + 责任信息”，以简洁分隔线串联信息簇，避免多卡片割裂。
- 基础与责任字段不再做色块卡片，而是以两列对齐的信息行展示：每行两个字段（示例：主机名称|IP地址、类型|来源、申请人|交付时间、责任人|责任部门），行底加轻量描边保持秩序与呼吸感。
- 规格信息固定 2×2 布局，每项展示 icon + 标签（CPU / MEM / DISK / OS）+ 数值，形成统一的“设备规格卡片”视觉；在窄屏降级为自适应列数。
- 申请时间字段取消，仅保留申请人 + 交付时间，字段需能在 `docs/asset-info-sample.xlsx` 中找到映射。
- 分组之间仍使用透明度 20% 的横线作分隔，标题不再重复出现。
- 下方新增“准入信息”分组，展示准入状态、最近核验时间、准入说明与来源，确保与安全管控区域解耦。

**中列分组规则（安全防护 & 安全风险）**
- 中列自上而下固定为两个区域：“安全防护”（EDR + 安全管控）与“安全风险”（告警 + 脆弱性）。
- 安全防护区域：
- 采用并列卡片（EDR代理 / 安全管控），卡片结构：左侧标题+说明，右侧状态标签（在线/离线/未安装/已管控）；正文以两行字段展示客户端版本、病毒库版本、同步时间、管控生效时间、准入状态等信息。
  - 当未安装EDR时，以醒目的红色提示文案替代字段列表；安全管控卡片在触发时展示原因与时间。
- 安全风险区域：
  - 告警部分以 24 小时趋势图呈现（按时间轴排列的彩色柱状），下方补充高/中/低危统计条块，使用对应告警级别颜色。
  - 脆弱性部分使用圆环/饼状图描述脆弱性类型占比（系统配置、应用组件、基线策略等），并以列表列出具体数量；当无脆弱性时以“暂无”标签代替并保持视觉占位。
- 所有卡片需沿用浅色科技风、半透明背景 + 渐变描边、微交互阴影；状态色遵循 UI 规范。

**右列分组规则（业务 / 责任 / 动态）**
- 卡片 1：关联业务（一级系统、二级系统），采用左右对齐的字段行显示；二级系统名称可点击跳转对应业务系统。
- 卡片 2：责任主体（责任人、责任单位、申请人、交付时间），强调对接主体，补充左列被移除的责任信息。
- 卡片 3：动态信息，以可折叠面板展示“主机申请”“策略与安全”等事件；面板标题=动态描述+完成时间，展开内容为文字说明，无需时间轴。
- 右列三个分节合并在单张卡片中，与左、中列卡片保持统一高度。

### 安全显著化规则（高亮）
- 顶部告警条（存在则显示）：
  - `已安全管控`（红色）：展示原因与时间，提供“查看详情/解除申请”入口（依权限）。
  - `EDR 未安装/未运行`（橙色）：展示修复建议与“去安装/重试心跳”入口。
  - `病毒库过期`（橙色）：展示版本与过期天数。
- 核心摘要 Chip 颜色：
  - 绿色：正常（EDR安装·在线、准入允许、无高危告警）；
  - 橙色：降级（EDR未运行、病毒库过期、有中危）；
  - 红色：安全管控/准入拒绝、有高危告警。
- 列表页强调：`防护状态` 显示“未安装/未运行”使用高对比 Tag；`安全管控` 在行操作下方追加小型告警提示。

```
+--------------------------------------------------------------------------------------------------+
| 业务资产管理 / 终端资产管理 / 云主机管理        [导入台账] [导出台账] [新建云主机]               |
+--------------------------------------------------------------------------------------------------+
| 业务板块[∨]  业务系统[∨]  业务资产[∨]  状态[运行/停止/未知]  防护[已防护/未防护]  同步来源[∨]     |
| 部门[多选]  基础字段设置[⚙ 名称/IP/责任人/资产/标签]  快捷筛选:[未受防护] [最近同步失败] [仅运行中] |
| 关键字 [_____________________________]                                  [查询] [重置条件]         |
+--------------------------------------------------------------------------------------------------+
| KPI: ① 纳管云主机 ② 在线率 ③ 异常主机 ④ 安全覆盖率(EDR安装&在线) ⑤ 安全管控主机               |
+--------------------------------------------------------------------------------------------------+
| 工具: [列设置] [批量操作▼] [刷新] 实时刷新 ON [15s▼]                                            |
|--------------------------------------------------------------------------------------------------|
| □ | 主机名称   | IP地址     | 运行状态 | 防护状态 | 关联业务资产(板块/系统/资产) | 部门  | 责任人 | … |
|----+-----------+------------+----------+----------+------------------------------+-------+--------+----|
| □ | host-001   | 10.10.1.11 | ●运行    | 盾受保护 | 一梁/支付系统/支付核心       | 技术部| 张伟   |    |
|    | 操作: 查看详情 / 编辑 / 导出 / 移除                                                               |
|----+-----------+------------+----------+----------+------------------------------+-------+--------+----|
| 分页 1 2 3 ...  [上一页][下一页]  每页 20 ▼                                                      |
+--------------------------------------------------------------------------------------------------+

云主机详情（独立页面，顶部摘要 + 三段式信息带）
--------------------------------------------------------------------------------------------------
面包屑 + 操作：返回列表 / 导出 / 同步 / 编辑（无Tab，一屏直观展现业务与安全重点）
--------------------------------------------------------------------------------------------------

顶部告警条：[已安全管控 RED] [EDR 未安装 ORANGE] [病毒库过期 ORANGE]

┌────────── 顶部摘要（Hero） ─────────────────────────────────────────────────────────────┐
│ 左：主机名 + 业务板块/系统/资产 + 责任部门/责任人 + 使用状态 + 申请人                              │
│ 右：四张 KPI 卡（未处理告警 / 脆弱性 / 安全管控状态 / 防护状态）+ 说明（管控时间·时长、最近同步等）        │
└────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────── 左侧：基础与责任（信息卡分组） ─────────────┐
│ · 主机身份卡：ID、IP、类型、标签，配 icon/色块突出身份                                     │
│ · 责任卡：部门/责任人/联系方式、申请人；可用颜色块或 avatar 呈现                        │
│ · 业务引用卡：业务板块/系统/资产跳转入口                                                 │
│ · 同步/规格卡：同步来源/时间、规格、操作系统（仅此处展示，避免与顶部重复）                 │
│ · 快捷操作：复制实体链接、查看审计记录                                                   │
└────────────────────────────────────────────┘

┌────────────── 中部：安全态势与时间轴（图表 + 时间线） ─────────────┐
│ 顶部：趋势面板（告警/事件/异常柱状 + 折线，颜色映射风险等级）                                  │
│ 中部：安全事件时间线（卡片式时间轴，支持策略/严重度筛选与操作入口）                          │
│ 底部：安全策略卡片（EDR版本、安全管控状态、准入、病毒库版本、最近同步；卡片可使用 icon/色条区分） │
└────────────────────────────────────────────┘

┌────────────── 右侧：业务洞察 / Insight（折叠卡方式） ─────────────┐
│ · 关联业务资产健康度/版本：使用进度条或色块表示                                               │
│ · 近期业务操作/变更：以标签/列表呈现，每项可带 icon                                         │
│ · 协同记录/工单/事件摘要：折叠面板结构，标题旁有状态颜色                                     │
│ · 查看更多链接，跳转到业务资产/协同工单模块                                                 │
└────────────────────────────────────────────┘

> 下半部分统一为“基础与责任 / 安全态势 / 业务洞察”三段式信息带，信息以卡片、图表、时间线或折叠块呈现，禁止使用简单表格或 KV 结构。
--------------------------------------------------------------------------------------------------

### 视觉/动效规范（NEW）
- **调色**：主视觉切换为浅色科技风渐变（`#f5f8ff → #eef4ff → #ffffff`）+ 蓝青高光，保证界面明亮、纯净但不失未来感。
- **质感**：卡片、筛选面板、Hero 概览统一采用玻璃拟态（淡白背景 + `backdrop-filter: blur(16px)`）与 24~32px 圆角，投影更新为 `0 30px 70px rgba(99,132,203,0.25)` 突出层次。
- **排版**：全局使用 `Outfit` 字体，遵循 8px 栅格与 `clamp` 响应式字号策略，大标题/数值强调业务 & 安全指标。
- **微交互**：KPI mini card 持续 `floatPulse` 动画，按钮/快速筛选 pill 在 hover 时 `translateY(-2px)` 并增强阴影，表格行 hover 出现浅蓝渐变底色。
- **状态呈现**：运行/防护状态统一采用浅色渐变 `statusChip`（绿/黄/红），顶部告警条沿用玻璃底 + 高对比文字，一眼聚焦风险；四张 KPI 卡片展示核心数字 + 简要文字说明即可。
- **无占位**：界面元素由真实 mock 数据驱动；若需插画使用 `generate_image` 生成，禁止灰色占位符。

**办公终端详情**
1. **概览**：资产卡片，展示设备名、IP、MAC、开机/在线状态、EDR状态、风险得分、业务板块/系统/资产/版本摘要。
2. **硬件配置**：CPU、内存、磁盘、设备SN、硬盘ID、设备类型、计算机用途。
3. **系统与安全**：操作系统（类型/版本/语言/安装时间/序列号/多系统标记）、安全代理（Agent类型/版本/审核状态）、杀毒软件信息、安全管控/锁定/保护状态及时间。
4. **网络与位置**：组织/部门/科室、所在地、交换机IP、资产号、资产分类、网络拓扑（预留展示EDR上报的交换机/端口信息）。
5. **使用与日志**：使用人、登录账号、注册/卸载时间、最后活跃时间、隔离/解除操作记录、导入批次。

以上字段分组会在UI中以标签页+分组卡片呈现，Tab间切换保持URL hash（便于直接定位）。

---

## 📈 统一资产统计分析细节（已定稿，独立二级菜单）

> **位置**：`业务资产管理` → `资产统计分析`（路由 `/management/asset-analytics`）。该页与终端资产管理平级，聚合云主机、办公终端及业务资产的数据洞察。

1. **过滤区**：固定在页面顶部，包含时间范围（默认最近30天）、业务板块/业务系统级联选择、部门多选、资产类型（云主机/终端/全部）、数据来源（云管/EDR/手工），任一过滤条件更新时所有图表联动刷新。
2. **关键指标卡**：四张KPI卡（纳管资产总数、在线率、异常资产、EDR覆盖率），可切换“云主机/办公终端”视角；展示环比+阈值颜色。
3. **云主机可视化**：
   - 状态分布：堆叠柱状图（RUNNING/STOPPED/UNKNOWN）按业务板块分布。
   - 规格热力：散点热力图（CPU×内存）显示数量密度。
   - 风险趋势：折线+柱混合图，展示近30天的告警数量、异常主机数。
4. **办公终端可视化**：
   - 在线率：双环形图（在线/离线/隔离 与 EDR安装/未安装）。
   - 部门分布：可下钻的树图，展示组织层级下的资产数量与风险点。
   - 安全管控&保护监控：面积图展示管控/解除数量，附带本周Top风险终端列表。
5. **跨资产联动**：
   - 选择某个业务板块或部门后，下方两个“Top列表”同时更新（云主机Top告警、终端Top安全管控）。
   - 图表支持导出PNG、数据下载CSV，复用`/api/terminal-assets/statistics/*`接口的聚合结果。

---

## 🧭 路由与菜单映射（已确认）

| 菜单/页面 | 路径 | 组件命名建议 | 说明 |
|-----------|------|--------------|------|
| 终端资产管理概览 | `/management/terminal-assets/overview` | `TerminalAssetsDashboard` | 展示KPI、健康分布、最近告警；默认进入路由 |
| 云主机管理 | `/management/terminal-assets/cloud-hosts` | `CloudHostList` / `CloudHostDetail` | 二级菜单；详情使用`/cloud-hosts/:id` |
| 办公终端管理 | `/management/terminal-assets/office-terminals` | `OfficeTerminalList` / `OfficeTerminalDetail` | 含隔离/解除操作；详情`/office-terminals/:id` |
| 资产集成配置 | `/management/terminal-assets/integrations` | `TerminalIntegrationConfig` | 配置云管、EDR、LDAP对接；含日志页 |
| 资产统计分析（业务资产管理二级） | `/management/asset-analytics` | `AssetAnalytics` | 独立于终端资产管理的统一资产统计分析中心 |

**菜单嵌套规则**
- `业务资产管理` 一栏下包含 `终端资产管理`（其子项顺序为“概览 → 云主机 → 办公终端 → 资产集成”）以及新的 `资产统计分析` 二级菜单。
- 面包屑：终端资产管理子页使用 `业务资产管理 / 终端资产管理 / {子页面}`，统计分析使用 `业务资产管理 / 资产统计分析`。
- 路由守卫与`ManagementLayout`一致，使用`VITE_SYSTEM_TYPE=management`时展示；协同系统下默认隐藏这些菜单但允许直接访问URL以便测试。

---

## 📋 功能需求清单

### 云主机管理
- [ ] 云主机列表（14列支持）
- [ ] 云主机详情（6维度信息）
- [ ] 新增/编辑/删除（支持14个字段）
- [ ] 批量编辑
- [ ] 导入/导出（Excel格式）
- [ ] 搜索、筛选、排序
- [ ] 实时状态刷新

### 办公终端管理
- [ ] 办公终端列表（关键字段）
- [ ] 办公终端详情（多维度信息）
- [ ] 新增/编辑/删除
- [ ] 设备隔离/解除隔离
- [ ] 批量编辑
- [ ] 导入/导出（Excel格式）
- [ ] 搜索、筛选、排序
- [ ] 实时在线状态刷新

### 资产集成配置
- [ ] 云管平台对接配置
- [ ] EDR系统对接配置
- [ ] LDAP对接配置（可选）
- [ ] 连接测试
- [ ] 自动同步调度
- [ ] 手动同步触发
- [ ] 同步状态监控
- [ ] 同步日志查看

### 资产统计分析（二级菜单，NEW）
- [ ] 云主机分布分析
- [ ] 云主机健康分析
- [ ] 云主机风险分析
- [ ] 办公终端分布分析
- [ ] 办公终端在线率分析
- [ ] 办公终端EDR覆盖率分析
- [ ] 办公终端风险分析
- [ ] （可选）业务资产关联分析
- [ ] 与业务板块/资产管理的指标联动（位于`/management/asset-analytics`）

---

## 🔌 API接口清单（调整）

### 云主机API (10个)
```
GET    /api/cloud-hosts
GET    /api/cloud-hosts/{id}
POST   /api/cloud-hosts
PUT    /api/cloud-hosts/{id}
DELETE /api/cloud-hosts/{id}
POST   /api/cloud-hosts/import
GET    /api/cloud-hosts/export
POST   /api/cloud-hosts/batch-update
DELETE /api/cloud-hosts/batch-delete
GET    /api/cloud-hosts/statistics
```

### 办公终端API (12个)
```
GET    /api/terminals
GET    /api/terminals/{id}
POST   /api/terminals
PUT    /api/terminals/{id}
DELETE /api/terminals/{id}
POST   /api/terminals/import
GET    /api/terminals/export
POST   /api/terminals/{id}/quarantine
POST   /api/terminals/{id}/release
POST   /api/terminals/batch-update
DELETE /api/terminals/batch-delete
GET    /api/terminals/statistics
```

### 集成配置API (8个)
```
GET    /api/integration-configs
POST   /api/integration-configs
PUT    /api/integration-configs/{id}
DELETE /api/integration-configs/{id}
POST   /api/integration-configs/{id}/test
POST   /api/integration-configs/{id}/sync
GET    /api/integration-configs/{id}/logs
GET    /api/integration-configs/sync-status
```

### 资产运营API (8个)
```
POST   /api/terminal-assets
PUT    /api/terminal-assets/{id}
DELETE /api/terminal-assets/{id}
POST   /api/terminal-assets/import
GET    /api/terminal-assets/export
POST   /api/asset-review/start
GET    /api/asset-review/{id}
GET    /api/terminal-assets/audit-log
```

### 统计分析API (2个)
```
GET    /api/terminal-assets/statistics/cloud-hosts
GET    /api/terminal-assets/statistics/terminals
```

> 以上统计API由 `资产统计分析` 二级菜单页面消费，同时也为终端资产概览页提供KPI数据。

**总计**: 32个API接口

---

## 💾 数据库设计概览

### 核心表结构

```
cloud_hosts 表 (14个主字段)
  ├─ id (PK)
  ├─ host_name
  ├─ ip_address
  ├─ status
  ├─ protection_status
  ├─ cpu, memory, disk
  ├─ os_type, os_version
  ├─ type (类型: 信创等)
  ├─ department
  ├─ business_block (业务板块)
  ├─ business_system (业务系统)
  ├─ business_asset_id (关联资产)
  ├─ business_version_id (关联业务版本)
  ├─ system_owner
  └─ data_source, sync_status, sync_time

office_terminals 表 (54个字段 + 系统字段)
  ├─ id (PK)
  ├─ serial_number
  ├─ ip_address, mac_address
  ├─ device_name
  ├─ business_block, business_system
  ├─ business_asset_id, business_version_id
  ├─ organization, department, office
  ├─ owner_name, login_account
  ├─ power_status, last_active_time
  ├─ agent_install_status
  ├─ blocking_status, lock_status, protection_status
  ├─ cpu_model, cpu_frequency
  ├─ disk_size, memory_size
  ├─ os_type, os_version, os_description
  ├─ device_type, device_sn
  └─ ... (其他54个字段)

integration_configs 表
  ├─ id (PK)
  ├─ config_name
  ├─ config_type (云管平台/EDR/LDAP)
  ├─ endpoint, protocol
  ├─ auth_type, credentials
  ├─ sync_interval, last_sync_time
  └─ status, status_message
```

**说明**:
- `cloud_hosts` 表和 `office_terminals` 表包含数据来源和同步状态字段，用于追踪数据的导入和同步情况
- 导入/导出通过这两个表的数据直接进行，无需额外的审计表（审计由业务保障管理系统的其他模块负责）

---

## 🚀 开发实施计划（调整）

### 第一阶段：框架搭建
- [ ] 创建菜单配置（在业务资产管理下）
- [ ] 创建页面目录结构
- [ ] 定义TypeScript类型（基于54+14字段）
- [ ] 创建Mock数据生成器
- [ ] 搭建Redux状态管理

### 第二阶段：核心页面实现
**P0 (必须)**:
- [ ] 仪表板首页
- [ ] 云主机列表页
- [ ] 办公终端列表页

**P1 (应该)**:
- [ ] 云主机详情页
- [ ] 办公终端详情页
- [ ] 资产集成配置页
- [ ] 资产统计分析页（业务资产管理二级菜单） ← **NEW**

**P2 (可以)**:
- [ ] 导入导出详细功能
- [ ] 高级筛选和报表

### 第三阶段：功能完善
- [ ] 搜索、筛选、排序
- [ ] 导入导出（Excel格式）
- [ ] 批量操作
- [ ] 实时数据刷新
- [ ] 设备隔离/解除隔离

### 第四阶段：集成对接
- [ ] API联调
- [ ] 集成配置实现
- [ ] 自动数据同步
- [ ] 异常告警通知

---

## ✅ 确认清单（最终版）

### 1. 菜单位置
- [x] **已调整** - 终端资产管理是业务资产管理的二级菜单；资产统计分析上提为同级的独立菜单

### 2. 功能整合
- [x] **已调整** - 云主机和终端统计分析合并为一个统一分析页面

### 3. 导入导出功能位置
- [x] **已确认** - 导入导出作为基础功能集成到云主机和终端管理页面

### 4. 数据模型覆盖
- [x] **已验证** - 覆盖Excel中的所有字段（云主机14列、终端54列）
- [x] **已调整** - 业务关联字段使用业务资产领域术语
  - 业务板块（对应Excel的"一级系统"）
  - 业务系统（对应Excel的"二级系统"）

### 5. 功能架构清晰性
- [x] **已确认** - 终端资产管理内的层级为“概览 → 云主机 → 办公终端 → 资产集成”，资产统计分析作为业务资产管理的并列二级菜单
- [x] **已确认** - 不包含资产运营功能
- [x] **已确认** - 导入导出功能位置明确（集成在各资产列表页面）

---

## 📍 后续开发确认项（更新）

### 1. Excel模板与校验器
   - 云主机与终端导入模板需统一版本号、字段说明；配套校验逻辑（必填/枚举）需在前端与后端同步确认。

### 2. 权限与操作审计
   - 终端隔离/解除、批量导入等操作需要确认权限点（角色：运维管理员、安全管理员）以及审计落库方案。

### 3. 同步失败告警策略
   - 集成配置中的同步失败是否需要推送到协同任务或资产运营模块；具体触发条件与告警渠道待确认。

---

**文档创建时间**: 2025-11-27
**最后更新**: 2025-11-27
**版本**: v1.4 (统计分析上提为二级菜单)
**状态**: 设计完成，待实施
